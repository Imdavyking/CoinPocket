"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[81778],{846778:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>d});var n=i(777754),s=i(62802),r=i(638456),o=i(470316),l=i(495046);const a=n.t(null,void 0,i(13262));function d(e,t){l.enabled("popup_hints")&&!r.CheckMobile.any()&&Promise.all([i.e(81910),i.e(48348),i.e(962),i.e(26166)]).then(i.bind(i,410837)).then((i=>{const n=new i.ChartEventHintRenderer(e),r=a.format({shortcut:(0,o.humanReadableHash)(o.Modifiers.Mod+86)});let l=null;n.show(r,(()=>{null!==l&&(clearTimeout(l),l=null,s.setValue(t,!0,{forceFlush:!0}))})),l=setTimeout((()=>{l=null,n.hide()}),5e3)}))}},741341:(e,t,i)=>{i.d(t,{getCanvasDevicePixelRatio:()=>l,getBindingPixelRatio:()=>a,getContext2D:()=>d,getPrescaledContext2D:()=>u,getPretransformedContext2D:()=>c,fillRect:()=>h,clearRect:()=>p,drawScaled:()=>v,createDisconnectedCanvas:()=>_,createDisconnectedBoundCanvas:()=>m,createBoundCanvas:()=>g,calcTextHorizontalShift:()=>b,disableSelection:()=>y,addExclusionArea:()=>S,measureText:()=>x});var n=i(327714),s=i(650151),r=i(768038),o=i(638456);function l(e){var t,i;return Math.max(1,(null===(i=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.devicePixelRatio)||1)}function a(e){return l(e.canvasElement)}function d(e){const t=(0,s.ensureNotNull)(e.getContext("2d"));return t.setTransform(1,0,0,1,0,0),t}function u(e){const t=(0,s.ensureNotNull)(e.getContext("2d")),i=l(e);return t.setTransform(i,0,0,i,0,0),t}function c(e,t){const i=(0,s.ensureNotNull)(e.canvasElement.getContext("2d")),n=a(e);return i.setTransform(n,0,0,n,0,0),t||i.translate(.5,.5),i}function h(e,t,i,n,s,r){e.save(),e.translate(-.5,-.5),e.fillStyle=r,e.fillRect(t,i,n,s),e.restore()}function p(e,t,i,n,s,r){e.save(),e.translate(-.5,-.5),e.globalCompositeOperation="copy",e.fillStyle=r,e.fillRect(t,i,n,s),e.restore()}function v(e,t,i){e.save(),e.scale(t,t),i(),e.restore()}function _(e,t,i){const n=f(e);return void 0===i&&(i=l(n)),n.width=t.width*i,n.height=t.height*i,n}function m(e,t){const i=f(e),s=(0,n.bindCanvasElementBitmapSizeTo)(i,{type:"device-pixel-content-box",transform:(e,t)=>({width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)})});return s.resizeCanvasElement(t),s}function f(e){const t=e.createElement("canvas");return y(t),t}function g(e,t){const i=f((0,s.ensureNotNull)(e.ownerDocument));e.appendChild(i);const r=(0,n.bindCanvasElementBitmapSizeTo)(i,{type:"device-pixel-content-box",transform:(e,t)=>({width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)})});return r.resizeCanvasElement(t),r}function b(e,t){return"center"===e.textAlign?0:(0,r.isRtl)()?"start"===e.textAlign||"right"===e.textAlign?t:0:"start"===e.textAlign||"left"===e.textAlign?0:t}function y(e){e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.MozUserSelect="none",e.style.webkitTapHighlightColor="transparent"}function S(e,t,i){e.beginPath(),e.rect(0,0,t.physicalWidth,t.physicalHeight);for(let n=0;n<i.length;n++){let{x:s,y:r}=i[n]
;s*=t.pixelRatio,r*=t.pixelRatio,0!==n?e.lineTo(s,r):e.moveTo(s,r)}e.closePath(),e.clip("evenodd")}let P;function x(e,t){return P||function(){const e=document.createElement("canvas");e.width=0,e.height=0,(0,o.isMac)()&&(e.style.display="none",document.body.append(e)),P=(0,s.ensureNotNull)(e.getContext("2d")),P.textBaseline="alphabetic",P.textAlign="center"}(),P.font=t,P.measureText(e)}},727775:(e,t,i)=>{i.d(t,{showCustomUrlEventDialog:()=>l});var n=i(777754),s=i(779923);const r=n.t(null,void 0,i(468988)),o=n.t(null,void 0,i(620036));async function l(e){const{onConfirm:t,onClose:i,title:n,placeholderText:l}=e;return(0,s.showRename)({title:n,text:"",placeholder:l,mainButtonText:r,cancelButtonText:o,onRename:({newValue:e,dialogClose:i})=>{t(e),i()},onClose:i})}},906125:(e,t,i)=>{i.d(t,{CHART_WIDGET_COLLECTION_SERVICE:()=>s,chartWidgetCollectionService:()=>r,CollectionViewMode:()=>o});var n=i(564894);const s={id:"ChartWidgetCollectionService"};function r(){return(0,n.hasService)(s)?(0,n.service)(s):null}var o;!function(e){e.Multichart="multichart",e.ForceFullscreen="force-fullscreen"}(o||(o={}))},573651:(e,t,i)=>{i.d(t,{InvalidationLevel:()=>n,InvalidationMask:()=>l,defaultInvalidationLevel:()=>o});var n,s=i(650151);class r{constructor(e=o){this._paneInvalidationLevel=o,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._legendWidgetInvalidated=!1,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidateLegendWidgetLayout(){this._legendWidgetInvalidated=!0}invalidatePriceScale(e,t,i){const n="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,s=n.get(t)||o;n.set(t,Math.max(s,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}legendWidgetLayoutInvalidated(){return this._legendWidgetInvalidated||this._invalidationLevel===n.Full}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||o,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach((e=>{e>i&&(i=e)})),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||o;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))})),e._rightPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||o;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})),this._legendWidgetInvalidated=this._legendWidgetInvalidated||e._legendWidgetInvalidated}}
!function(e){e[e.None=0]="None",e[e.Cursor=1]="Cursor",e[e.Light=2]="Light",e[e.Full=3]="Full"}(n||(n={}));const o=n.None;class l{constructor(e=o){this._panesOrderChanged=!1,this._keepVisibleTimeRangeOnResize=!1,this._timeAxisInvalidationLevel=o,this._invalidatedPanes=new Map,this._additionalActions=[],this._invalidationLevel=e}invalidateAll(e){this._invalidationLevel!==e&&(this._invalidationLevel=Math.max(this._invalidationLevel,e),this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})))}invalidateAllPane(e,t){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new r(this._invalidationLevel)),(0,s.ensureDefined)(this._invalidatedPanes.get(e)).invalidateAll(t)}invalidatePriceScale(e,t,i,n){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new r(this._invalidationLevel)),(0,s.ensureDefined)(this._invalidatedPanes.get(e)).invalidatePriceScale(t,i,n)}invalidateTimeScale(e){this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e)}invalidatePanesOrder(){this._panesOrderChanged=!0}lockVisibleTimeRangeOnResize(){this._keepVisibleTimeRangeOnResize=!0}fullInvalidation(){return this._invalidationLevel}maxPaneInvalidation(){const e=[];return this._invalidatedPanes.forEach((t=>{e.push(t.fullInvalidation())})),Math.max(...e,this._invalidationLevel)}invalidateForPane(e){return this._invalidatedPanes.get(e)||new r(this._invalidationLevel)}invalidateForTimeScale(){return Math.max(this._timeAxisInvalidationLevel,this._invalidationLevel)}validationActions(){return this._additionalActions}addValidationAction(e){this._additionalActions.push(e)}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._panesOrderChanged=this._panesOrderChanged||e._panesOrderChanged,this._keepVisibleTimeRangeOnResize=this._keepVisibleTimeRangeOnResize||e._keepVisibleTimeRangeOnResize,this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})),e._invalidatedPanes.forEach(((e,t)=>{this._invalidatedPanes.has(t)||this._invalidatedPanes.set(t,new r(this._invalidationLevel)),(0,s.ensureDefined)(this._invalidatedPanes.get(t)).merge(e)})),this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e._timeAxisInvalidationLevel);for(let t=0;t<e._additionalActions.length;t++)this._additionalActions.push(e._additionalActions[t])}panesOrderInvalidated(){return this._panesOrderChanged}isVisibleTimeRangeLockedOnResize(){return this._keepVisibleTimeRangeOnResize}static cursor(){return new l(n.Cursor)}static light(){return new l(n.Light)}static full(){return new l(n.Full)}static panesOrder(){const e=l.full();return e.invalidatePanesOrder(),e}static invalidateLegendWidgetLayout(e){var t;const i=new l;return i._invalidatedPanes.set(e,new r),null===(t=i._invalidatedPanes.get(e))||void 0===t||t.invalidateLegendWidgetLayout(),i}static validateAction(e){const t=new l;return t._additionalActions.push(e),t}}},545613:(e,t,i)=>{i.d(t,{lastMouseOrTouchEventInfo:()=>s,setLastMouseOrTouchEventInfo:()=>r});let n=(0,i(638456).supportTouch)()?{isTouch:!0,
stylus:!1}:{isTouch:!1};function s(){return n}function r(e){n=e.isTouch?{isTouch:!0,stylus:e.stylus}:{isTouch:!1}}},282151:(e,t,i)=>{i.d(t,{DataSource:()=>d});var n=i(495046),s=i(988411),r=i.n(s),o=i(777491),l=i(869403),a=i.n(l);class d{constructor(e){this.hasAlert=new(r())(!1),this._zorder=0,this.m_priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._onPriceScaleChanged=new(a()),this._isSelectionEnabled=!0,this._instanceId=(0,o.randomHashN)(6),this._ownerSourceChanged=new(a()),this._zOrderChanged=new(a()),this._id=null!=e?e:(0,o.randomHashN)(6)}id(){return this._id}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id=e}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}isSpeciallyZOrderedSource(){return!1}title(){throw new Error("Implement this fun in a subclass")}name(){throw new Error("Implement this fun in a subclass")}priceScale(){return this.m_priceScale}setPriceScale(e){this.m_priceScale=e,this._onPriceScaleChanged.fire()}ownerSource(){return this._ownerSource}setOwnerSource(e){const t=this._ownerSource;this._ownerSource=e,this._ownerSourceChanged.fire(t,e)}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){throw new Error("Implement this fun in a subclass")}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(e){}paneViews(e){return null}labelPaneViews(){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(e){}getSourceIcon(){return null}state(e){throw new Error("Implement this fun in a subclass")}onPriceScaleChanged(){return this._onPriceScaleChanged}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}showOnTopOnHovering(){return!0}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e}firstValue(){return null}priceRange(e,t){return null}autoScaleInfo(e,t){return{range:this.priceRange(e,t)}}stateForAlert(){return null}canHasAlert(){return!1}alertCreationAvailable(){return new(r())(this.hasStateForAlert()).readonly()}hasStateForAlert(){return n.enabled("alerts")}idForAlert(){return this._id}}},87225:(e,t,i)=>{i.r(t),i.d(t,{createDefaultsState:()=>h,saveDefaultProperties:()=>v,DefaultProperty:()=>_})
;var n=i(822914),s=i(712433),r=i(702040),o=i(16665),l=i(40210),a=i.n(l),d=i(869403),u=i.n(d);function c(e,t){const i=(0,n.default)(e);return t.forEach((e=>(0,r.default)(i,e.split(".")))),i}function h(e,t,i,r){const l=e?o.defaults:o.factoryDefaults,a=t.startsWith("study_")?(0,n.default)(l("study")):{};let d=(0,n.default)(l(t,r));return t.startsWith("study_")&&d.inputs&&delete d.inputs.symbol,"linetoolicon"===t&&e&&(d.icon=(0,o.defaults)(t).icon),"linetooemoji"===t&&e&&(d.emoji=(0,o.defaults)(t).emoji),d=c(d,i),(0,s.default)(a,d),a}let p=!1;function v(e){p=e}class _ extends(a()){constructor(e,t,i,n){super(function(e,t,i,n){let r;return void 0===n&&(n=!0),i?r=t:(r=h(n,e,[],null),t&&(0,s.default)(r,t)),r}(e,t,i,n)),this._exclusions=[],this._restoreFactoryDefaultsEvent=new(u()),this._defaultName=e,this._useUserPreferences=null==n||n,this.listeners().subscribe(this,_.prototype.onPropertyChanged),this._restoreFactoryDefaultsEvent=new(u())}preferences(){return this.state(this._exclusions)}mergePreferences(e){this.mergeAndFire(c(e,this._exclusions))}addExclusion(e){this._exclusions.indexOf(e)<0&&this._exclusions.push(e)}removeExclusion(e){const t=this._exclusions.indexOf(e);-1!==t&&this._exclusions.splice(t,1)}restoreFactoryDefaults(){const e=h(!1,this._defaultName,this._exclusions,null);this.mergeAndFire(e),this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||(0,o.saveDefaults)(this._defaultName,void 0),this._restoreFactoryDefaultsEvent.fire()}onRestoreFactoryDefaults(){return this._restoreFactoryDefaultsEvent}onPropertyChanged(){!p||this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||this.saveDefaults()}saveDefaults(){this._useUserPreferences&&(0,o.saveDefaults)(this._defaultName,this.preferences())}clone(e){const t=new _(this._defaultName,this.state(),null==e?void 0:e.replaceByState,this._useUserPreferences);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}}},480071:(e,t,i)=>{i.r(t),i.d(t,{SelectPointMode:()=>n,toolIsCursor:()=>v,toolIsMeasure:()=>_,resetToCursor:()=>m,lockTimeAxisTime:()=>x,tool:()=>T,iconTool:()=>w,emojiTool:()=>C,cursorTool:()=>A,isToolCreatingNow:()=>I,isToolEditingNow:()=>M,isToolMovingNow:()=>L,isDirectionalMovementActive:()=>R,createdLineTool:()=>D,continuedLineTool:()=>V,cancelledLineTool:()=>k,beenSetLineToolLastPoint:()=>E,startedMovingLineTool:()=>N,movedLineTool:()=>F,finishedMovingLineTool:()=>z,startedChangingLineTool:()=>O,changedLineTool:()=>H,finishedChangingLineTool:()=>B,removedLineTool:()=>W,finishedLineTool:()=>U,changedLineStyle:()=>K,copiedLineTool:()=>j,restoredLineTool:()=>G,restoredLineToolState:()=>$,activePointSelectionMode:()=>Z,isStudyEditingNow:()=>q,createLineTool:()=>Q,continueLineTool:()=>X,cancelLineTool:()=>ee,setLineToolLastPoint:()=>te,startMovingLineTool:()=>ie,moveLineTool:()=>ne,finishMovingLineTool:()=>se,startChangingLineTool:()=>re,changeLineTool:()=>oe,finishChangingLineTool:()=>le,removeLineTool:()=>ae,finishLineTool:()=>de,changeLineStyle:()=>ue,
copyLineTool:()=>ce,restoreLineTool:()=>he,restoreLineToolState:()=>pe,init:()=>me,runOnDrawingStateReady:()=>fe,properties:()=>ge,hideAllDrawings:()=>be,hideAllIndicators:()=>ye,lockDrawings:()=>Se,hideMarksOnBars:()=>Pe,drawOnAllCharts:()=>xe,drawOnAllChartsMode:()=>Te,lockTimeAxis:()=>we});var n,s=i(650151),r=i(506845),o=i(87225),l=i(16665),a=i(988411),d=i.n(a),u=i(869403),c=i.n(u),h=i(62802),p=i(251954);function v(e){return"cursor"===e||"arrow"===e||"dot"===e}function _(e){return"measure"===e}function m(e=!1){if(!e&&f){if(f.childs().stayInDrawingMode.value())return}T.setValue(A.value())}!function(e){e[e.None=0]="None",e[e.Replay=1]="Replay",e[e.Study=2]="Study"}(n||(n={}));let f=null,g=null,b=null,y=null,S=null,P=null;const x=new(d()),T=new(d()),w=new(d()),C=new(d()),A=new(d()),I=new(d())(!1),M=new(d())(!1),L=new(d())(!1),R=new(d())(!1),D=new(c()),V=new(c()),k=new(c()),E=new(c()),N=new(c()),F=new(c()),z=new(c()),O=new(c()),H=new(c()),B=new(c()),W=new(c()),U=new(c()),K=new(c()),j=new(c()),G=new(c()),$=new(c()),Z=new(d())(n.None),q=new(d())(!1);function Y(e,t){const i=t||{value:!1};return t=>{i.value||(i.value=!0,e.fire(t),i.value=!1)}}const J={value:!1},Q=Y(D,J),X=Y(V,J),ee=Y(k,J),te=Y(E,J),ie=Y(N),ne=Y(F),se=Y(z),re=Y(O),oe=Y(H),le=Y(B),ae=Y(W),de=Y(U),ue=Y(K,J),ce=Y(j,J),he=Y(G),pe=Y($);let ve=!1,_e=[];function me(){ve||(T.setValue(h.getValue("chart.cursorPreference","cursor")),T.subscribe((e=>v(e)&&A.setValue(e)),{callWithLast:!0}),A.subscribe((e=>{e&&h.setValue("chart.cursorPreference",e)})),f=new o.DefaultProperty("drawings"),g=(0,r.createPrimitiveProperty)(),b=(0,r.createPrimitiveProperty)(),y=(0,r.createPrimitiveProperty)(),S=(0,r.createPrimitiveProperty)(),P=(0,r.createPrimitiveProperty)(),g.setValue(!1),b.setValue(!1),y.setValue(!1),S.setValue(!1),P.setValue(!1),T.subscribe((()=>{(0,p.emit)("onSelectedLineToolChanged")})),w.subscribe((()=>{(0,l.saveDefaults)("linetoolicon",{...(0,l.defaults)("linetoolicon"),icon:w.value()})})),C.subscribe((()=>{(0,l.saveDefaults)("linetoolemoji",{...(0,l.defaults)("linetoolemoji"),emoji:C.value()})})),ve=!0,_e.forEach((e=>e())),_e=[])}function fe(e){ve?e():_e.push(e)}function ge(){return(0,s.ensureNotNull)(f)}function be(){return(0,s.ensureNotNull)(g)}function ye(){return(0,s.ensureNotNull)(b)}function Se(){return(0,s.ensureNotNull)(y)}function Pe(){return(0,s.ensureNotNull)(S)}function xe(){return ge().childs().drawOnAllCharts}function Te(){return ge().childs().drawOnAllChartsMode}function we(){return(0,s.ensureNotNull)(P)}},858063:(e,t,i)=>{function n(e,t,i){if(e.isTouch){if(void 0!==i)return i(e),!0}else if(void 0!==t)return t(e),!0;return!1}function s(e,t,i,n){return void 0!==t.executeDefaultAction&&(e.isTouch?Boolean(t.executeDefaultAction[n]):Boolean(t.executeDefaultAction[i]))}var r;i.d(t,{tryCallHandler:()=>n,shouldDefaultActionBeExecuted:()=>s,AreaName:()=>r,HitTestResult:()=>o}),function(e){e.Style="Style",e.Text="Text",e.SourceItemMove="SourceItemMove"}(r||(r={}));class o{constructor(e,t,i){this._result=e,this._data=t||null,this._eraseMarker=i}result(){
return this._result}data(){return this._data}hasPressedMoveHandler(e){return null!==this._data&&function(e,t,i){if(e.isTouch){if(void 0!==i)return!0}else if(void 0!==t)return!0;return!1}(e,this._data.pressedMouseMoveHandler,this._data.touchMoveHandler)}tryCallMouseDownOrTouchStartHandler(e){return null!==this._data&&n(e,this._data.mouseDownHandler,this._data.touchStartHandler)}tryCallMouseUpOrTouchEndHandler(e){return null!==this._data&&n(e,this._data.mouseUpHandler,this._data.touchEndHandler)}tryCallMouseEnterHandler(e){return null!==this._data&&n(e,this._data.mouseEnterHandler)}tryCallMouseLeaveHandler(e){return null!==this._data&&n(e,this._data.mouseLeaveHandler)}tryCallMouseMoveHandler(e){return null!==this._data&&n(e,this._data.mouseMoveHandler)}tryCallClickOrTapHandler(e){return null!==this._data&&n(e,this._data.clickHandler,this._data.tapHandler)}tryCallDblClickOrDblTapHandler(e){return null!==this._data&&n(e,this._data.doubleClickHandler,this._data.doubleTapHandler)}tryCallContextMenuHandler(e){return null!==this._data&&n(e,this._data.contextMenuHandler,this._data.touchContextMenuHandler)}eraseMarker(){return this._eraseMarker}}o.MOVEPOINT_BACKGROUND=1,o.REGULAR=2,o.MOVEPOINT=3,o.CHANGEPOINT=4,o.CUSTOM=5},488792:(e,t,i)=>{i.d(t,{intervalsVisibilitiesDefaults:()=>n});const n={ticks:!0,seconds:!0,secondsFrom:1,secondsTo:59,minutes:!0,minutesFrom:1,minutesTo:59,hours:!0,hoursFrom:1,hoursTo:24,days:!0,daysFrom:1,daysTo:366,weeks:!0,weeksFrom:1,weeksTo:52,months:!0,monthsFrom:1,monthsTo:12,ranges:!0}},450556:(e,t,i)=>{i.d(t,{IntervalsVisibilitiesProperty:()=>o});var n=i(40210),s=i.n(n),r=i(323017);class o extends(s()){state(e){var t;return null!==(t=(0,r.nonDefaultIntervalsVisibilities)(super.state(e)))&&void 0!==t?t:void 0}storeStateIfUndefined(){return!1}}},323017:(e,t,i)=>{i.d(t,{makeIntervalsVisibilitiesVisibleAtInterval:()=>a,isActualInterval:()=>u,nonDefaultIntervalsVisibilities:()=>c,mergeIntervalVisibilitiesDefaults:()=>h,getIntervalsVisibilitiesForMode:()=>p});var n=i(712433),s=i(822914),r=i(650151),o=i(568450),l=i(488792);function a(e,t){let i=t.multiplier();if(t.isTicks()&&(e.ticks=!0),t.isSeconds()&&(i<60?(e.seconds=!0,e.secondsFrom=Math.min(e.secondsFrom,i),e.secondsTo=Math.max(e.secondsTo,i)):(i=Math.floor(i/60),t=new o.Interval(o.ResolutionKind.Minutes,i))),t.isMinutes())if(i<60)e.minutes=!0,e.minutesFrom=Math.min(e.minutesFrom,i),e.minutesTo=Math.max(e.minutesTo,i);else{const t=Math.floor(i/60);e.hours=!0,e.hoursFrom=Math.min(e.hoursFrom,t),e.hoursTo=Math.max(e.hoursTo,t)}t.isDays()&&(e.days=!0,e.daysFrom=Math.min(e.daysFrom,i),e.daysTo=Math.max(e.daysTo,i)),t.isWeeks()&&(e.weeks=!0,e.weeksFrom=Math.min(e.weeksFrom,i),e.weeksTo=Math.max(e.weeksTo,i)),t.isMonths()&&(e.months=!0,e.monthsFrom=Math.min(e.monthsFrom,i),e.monthsTo=Math.max(e.monthsTo,i)),t.isRange()&&(e.ranges=!0)}function d(e,t,i,n){return e&&n>=t&&n<=i}function u(e,t){const i=t.childs();switch(e.kind()){case o.ResolutionKind.Ticks:return i.ticks.value();case o.ResolutionKind.Seconds:
if(e.multiplier()<60)return d(i.seconds.value(),i.secondsFrom.value(),i.secondsTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return d(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),t)}case o.ResolutionKind.Minutes:if(e.multiplier()<60)return d(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return d(i.hours.value(),i.hoursFrom.value(),i.hoursTo.value(),t)}case o.ResolutionKind.Days:return d(i.days.value(),i.daysFrom.value(),i.daysTo.value(),e.multiplier());case o.ResolutionKind.Weeks:return d(i.weeks.value(),i.weeksFrom.value(),i.weeksTo.value(),e.multiplier());case o.ResolutionKind.Months:return d(i.months.value(),i.monthsFrom.value(),i.monthsTo.value(),e.multiplier());case o.ResolutionKind.Range:return i.ranges.value()}return(0,r.assert)(!1,`Unsupported resolution: ${e.value()}`),!1}function c(e){const t=Object.keys(e).filter((t=>l.intervalsVisibilitiesDefaults[t]!==e[t]));return 0===t.length?null:t.reduce(((t,i)=>(t[i]=e[i],t)),{})}function h(e){return(0,n.default)((0,s.default)(l.intervalsVisibilitiesDefaults),null!=e?e:{})}function p(e,t){if(0===t||e.isTicks()&&3===t||e.isRange()&&2===t)return h();let i=!1;const n={ticks:!1,seconds:!1,minutes:!1,hours:!1,days:!1,weeks:!1,months:!1,ranges:!1},s=e=>e.multiplier();return[{checker:e=>e.isTicks(),getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.ticks=!0}},{checker:e=>e.isSeconds()&&e.multiplier()<60,getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.seconds=!0,n.secondsFrom=e,n.secondsTo=t}},{checker:e=>e.isSeconds()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{n.minutes=!0,n.minutesFrom=e,n.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()<60,getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.minutes=!0,n.minutesFrom=e,n.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{n.hours=!0,n.hoursFrom=e,n.hoursTo=t}},{checker:e=>e.isDays(),getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.days=!0,n.daysFrom=e,n.daysTo=t}},{checker:e=>e.isWeeks(),getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.weeks=!0,n.weeksFrom=e,n.weeksTo=t}},{checker:e=>e.isMonths(),getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.months=!0,n.monthsFrom=e,n.monthsTo=t}},{checker:e=>e.isRange(),getIntervalMultiplier:s,markIntervalAsVisible:(e,t)=>{n.ranges=!0}}].forEach((n=>{if(n.checker(e)){i=!0;const s=n.getIntervalMultiplier(e);1===t?n.markIntervalAsVisible(s,s):3===t?n.markIntervalAsVisible(s,void 0):n.markIntervalAsVisible(void 0,s)}else(!i&&2===t||i&&3===t)&&n.markIntervalAsVisible(void 0,void 0)})),h(n)}},812363:(e,t,i)=>{var n;i.d(t,{PlotRowSearchMode:()=>n}),function(e){e[e.NearestLeft=-1]="NearestLeft",e[e.Exact=0]="Exact",e[e.NearestRight=1]="NearestRight"}(n||(n={}))},354145:(e,t,i)=>{function n(e){
const t=(null==e?void 0:e.symbolSource)&&e.symbolSource()===e,i=void 0!==(null==e?void 0:e.isActingAsSymbolSource);return t||i}function s(e){return n(e)&&e.isActingAsSymbolSource().value()}i.d(t,{isSymbolSource:()=>n,isActingAsSymbolSource:()=>s})},812080:(e,t,i)=>{i.d(t,{CustomEventItem:()=>r,LineToolCustomUrlEvent:()=>o});var n=i(650151),s=i(343135);class r{constructor(e){this._source=e}position(){return this._props().childs().position.value()}_props(){return this._source.properties()}}class o extends s.LineToolWithRelativePriceCoordinate{constructor(){super(...arguments),this._item=null,this._eventTimePointIndex=null}pointsCount(){return 1}cloneable(){return!1}eventTimePointIndex(){return this._eventTimePointIndex}customEvent(){return this._item}restorePoints(e,t,i){i&&t.length>0&&(this._eventTimePointIndex=t[0].index),super.restorePoints(e,t,i)}priceAxisPoints(){return[]}_baseSeriesIndexForPoint(e){var t;return null!==(t=this._eventTimePointIndex)&&void 0!==t?t:e.index}_alignPointHorizontallyOrVertically(e){var t,i;if(null===this._eventTimePointIndex)return e;const s=this._points[0].index-this._eventTimePointIndex,r=(0,n.ensure)(null===(i=null===(t=this._startMovingPoint)||void 0===t?void 0:t.logical)||void 0===i?void 0:i.index)-s;return{price:e.price,index:r}}_snapPoint45Degree(e,t,i){this._eventTimePointIndex&&(e.index=this._eventTimePointIndex)}_snapTo45DegreesAvailable(){return!0}_allowChangeAnchorHorizontally(){return!0}_pointsForPointset(){return[[(0,n.ensureNotNull)(this._item).time(),0],...super._pointsForPointset()]}_onPointsetUpdated(e){if(0===e.length)return;const t=e.findIndex((e=>0===e.index));-1!==t&&(this._eventTimePointIndex=e[t].value[0]);const i=e.slice(1).map((e=>({value:e.value,index:e.index-1})));super._onPointsetUpdated(i)}_readyToCreatePointset(){return super._readyToCreatePointset()&&null!==this._item}}},446e3:(e,t,i)=>{i.d(t,{isIdeaUrl:()=>v,isScriptUrl:()=>_,isPreviewUrl:()=>m,isIdeaAuthorProfileImageUrl:()=>f,createIdeaLineToolByUrl:()=>b});var n=i(650151),s=i(62802),r=i(66974),o=i(777491),l=i(809350),a=i(700950);const d=/^\/chart\/.+?\/([0-9a-zA-Z]{8})(-[-\w]+)?\/?$/,u=/^\/script\/([0-9a-zA-Z]{8})(-[-\w]+)?\/?$/,c=/^\/i\/([0-9a-zA-Z]{8})\/?(?:$|(?=[\s;,.]))\/?$/;const h=e=>"https:"===e.protocol&&e.hostname.endsWith(".tradingview.com"),p=e=>!(0,r.isProd)()&&e.hostname.endsWith(window.location.hostname);function v(e){try{const t=new URL(e);return(h||p)&&d.test(t.pathname)}catch(e){return!1}}function _(e){try{const t=new URL(e);return(h||p)&&u.test(t.pathname)}catch(e){return!1}}function m(e){try{const t=new URL(e);return(h||p)&&c.test(t.pathname)}catch(e){return!1}}function f(e){if(e.startsWith("data:image/svg+xml,"))return!0;try{const t=new URL(e),i=new URL(window.AWS_S3_CDN);return t.protocol===i.protocol&&t.hostname===i.hostname&&t.pathname.includes("/userpics/")}catch(e){return!1}}async function g(e){const t=new URL(`/api/v1/ideas/${i=e,(0,n.ensureNotNull)(d.exec(new URL(i).pathname))[1]}/`,location.href);var i;return fetch(t.toString()).then((e=>{
if(!e.ok)throw new Error(`Error processing idea: ${e.statusText}`);return e.json()}))}function b(e,t,i=!1){return g(e).then((e=>{const r=function(e,t){var i;const s=(0,n.ensureDefined)(e.user);let r;s.avatars&&f(s.avatars.small)&&(r=s.avatars.small.startsWith("data:image/svg+xml,")?s.avatars.small:`${s.avatars.small.replace(window.AWS_S3_CDN,"")}?resetCache=true`);const o={avatarUrl:r,badges:null===(i=s.badges)||void 0===i?void 0:i.map((e=>e.name)),username:s.username};return{createdAt:e.created_timestamp,direction:e.direction,name:(0,l.clean)(e.name,!0),author:o,uuid:e.uuid}}(e),d={price:0,time_t:r.createdAt,offset:0},u=t.mainSeries(),c=(0,n.ensureNotNull)(t.model().paneForSource(u)),h=c.newLineToolZOrder(!0),p={type:"drawing",source:{id:(0,o.randomHashN)(6),zorder:h,type:"LineToolIdea",position:50,state:{interval:"1",...a.LineToolIdea.createProperties().state()},ideaData:r,symbol:u.symbol(),ownerSource:u.id(),points:[d]},geometry:[],modelId:t.model().id()},v=t.pasteLineTool(c,p,!0,!0);return i&&s.setValue("hint.pasteIdea",!0,{forceFlush:!0}),v.pointAdded().subscribe(null,(()=>t.scrollToLineTool(v)),!0),v}))}},700950:(e,t,i)=>{i.d(t,{LineToolIdea:()=>T});var n=i(87225),s=i(892142),r=i(777754),o=i(62802),l=i(345848),a=i(272001),d=i(846778),u=i(906125),c=i(480071),h=i(727775),p=i(446e3);const v=(0,a.getLogger)("Chart.IdeaDialog"),_=r.t(null,void 0,i(241246)),m=r.t(null,void 0,i(467466));let f=null;function g(e){"LineToolIdea"===e?(window.is_authenticated||(0,c.resetToCursor)(!0),window.runOrSignIn((()=>{c.tool.setValue("LineToolIdea"),f=(0,h.showCustomUrlEventDialog)({onConfirm:b,onClose:()=>{f=null,"LineToolIdea"===c.tool.value()&&(0,c.resetToCursor)(!0)},title:_,placeholderText:m}),(0,l.trackEvent)("Idea","Open idea dialog")}),{source:"Change drawing tool state"})):null!==f&&f.then((e=>e()))}function b(e){const t=(0,u.chartWidgetCollectionService)();if(null===t)return;if(!(0,p.isIdeaUrl)(e))return void v.logWarn(`Invalid idea url: ${e}`);const i=!Boolean(o.getBool("hint.pasteIdea")),n=t.activeChartWidget.value();(0,p.createIdeaLineToolByUrl)(e,n.model()).then((()=>{i&&(0,d.showPasteLineToolHint)(t.getContainer(),"hint.pasteIdea")}))}var y=i(40210),S=i.n(y),P=i(812080);class x extends P.CustomEventItem{constructor(e,t){super(t),this._data=e}ideaData(){return this._data}index(){return this._source.eventTimePointIndex()}time(){return this._data.createdAt}avatar(){var e;return null===(e=this._data.author)||void 0===e?void 0:e.avatarUrl}}class T extends P.LineToolCustomUrlEvent{constructor(e,t,n,s){super(e,t||T.createProperties(),n,s),Promise.all([i.e(47342),i.e(81679),i.e(51583)]).then(i.bind(i,367484)).then((t=>{this._setPaneViews([new t.IdeaPaneView(this,e)])}))}name(){return"Idea"}state(e){const t=super.state(e);return this._item&&(t.ideaData=this._item.ideaData()),e&&(t.eventTimePointIndex=this._eventTimePointIndex),t}restoreData(e){e.ideaData&&(this._item=new x(e.ideaData,this)),void 0!==e.eventTimePointIndex&&(this._eventTimePointIndex=e.eventTimePointIndex)}static createProperties(e){
const t=new n.DefaultProperty("linetoolIdea",e);return this._configureProperties(t),t.hasChild("position")||t.addChild("position",new(S())(50)),t.addExclusion("position"),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(53465),i.e(59955),i.e(44728),i.e(60821),i.e(18537)]).then(i.bind(i,290627)).then((e=>e.IdeaDefinitionsViewModel))}static _configureProperties(e){s.LineDataSource._configureProperties(e)}}(0,c.runOnDrawingStateReady)((()=>{c.tool.subscribe(g)}))},493100:(e,t,i)=>{i.d(t,{LineDataSourcePointIndexProperty:()=>r});var n=i(40210),s=i.n(n);class r extends(s()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){return this._lineSource.points()[this._pointIndex].index}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.index=e,this._lineSource.startChanging(this._pointIndex,t),this._setPointImpl(t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}_setPointImpl(e){this._lineSource.setPoint(this._pointIndex,e)}}},861765:(e,t,i)=>{i.d(t,{LineToolPriceAxisView:()=>o});var n=i(650151),s=i(841404),r=i(114123);class o extends s.PriceAxisView{constructor(e,t){super(),this._active=!1,this._source=e,this._data=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_updateRendererData(e,t,i){e.visible=!1;const n=this._source.model();if(!n.timeScale()||n.timeScale().isEmpty())return;const s=this._source.priceScale();if(null===s||s.isEmpty())return;if(!n.selection().isSelected(this._source)&&!this._source.isForcedDrawPriceAxisLabel())return;if(null===n.timeScale().visibleBarsStrictRange())return;const o=this._source.priceAxisPoints(),l=this._data.pointIndex;if(o.length<=l)return;const a=o[l];if(!isFinite(a.price))return;const d=this._source.ownerSource(),u=null!==d?d.firstValue():null;if(null===u)return;let c=this._data.backgroundPropertyGetter?this._data.backgroundPropertyGetter():null;null===c&&(c=this._getBgColor()),i.background=(0,r.resetTransparency)(c),i.borderColor="#2E84A6",i.textColor=this.generateTextColor(i.background),i.coordinate=s.priceToCoordinate(a.price,u),e.text=this._formatPrice(a.price,u),e.visible=!0}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_formatPrice(e,t){return(0,n.ensureNotNull)(this._source.priceScale()).formatPrice(e,t)}}},231193:(e,t,i)=>{i.d(t,{LineDataSourceTimeAxisView:()=>s});var n=i(81947);class s extends n.TimeAxisView{constructor(e,t){super(e.model()),this._active=!1,this._source=e,this._pointIndex=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null
;const e=this._source.timeAxisPoints();return e.length<=this._pointIndex?null:e[this._pointIndex].index}_isVisible(){return!0}}},892142:(e,t,i)=>{i.d(t,{LineDataSource:()=>B});var n=i(86441),s=i(650151),r=i(251954),o=i(272001),l=i(495046),a=i(282151),d=i(480071),u=i(869403),c=i.n(u),h=i(40210),p=i.n(h),v=i(241056),_=i(861765),m=i(231193);class f extends(p()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t,e.pointAdded().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)})),e.pointChanged().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)}))}value(){const e=this._lineSource.points()[this._pointIndex].price,t=(0,s.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),n=t.parse(i);return n.res?n.value:e}return e}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.price=parseFloat(""+e),this._lineSource.startChanging(this._pointIndex,t),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}var g=i(493100),b=i(568450),y=i(835343),S=i(992001),P=i(720444),x=i(930981),T=i(190096),w=i(844106),C=i(988411),A=i.n(C),I=i(573651),M=i(991826),L=i(323017),R=i(488792),D=i(450556),V=i(758337),k=i(404822),E=i(354145),N=i(51782);const F=(0,o.getLogger)("Chart.LineDataSource"),z=l.enabled("datasource_copypaste");class O{constructor(){this._states=[]}start(e){this._states.push(e)}finish(e){const t=(0,s.ensureDefined)(this._states.pop());return n=t,(i=e).length!==n.length?{indexesChanged:!0,pricesChanged:!0}:i.reduce(((e,t,i)=>{const s=n[i];return e.indexesChanged=e.indexesChanged||t.index!==s.index,e.pricesChanged=e.pricesChanged||t.price!==s.price,e}),{indexesChanged:!1,pricesChanged:!1});var i,n}isEmpty(){return 0===this._states.length}}let H=0;class B extends a.DataSource{constructor(e,t,i,n){if(super(n),this.version=1,this.toolname="",this.customization={forcePriceAxisLabel:!1,disableErasing:!1,disableSave:!1,showInObjectsTree:!0},this._currentPointsetAndSymbolId=null,this._pointChanged=new(c()),this._pointAdded=new(c()),this._priceAxisViews=[],this._timeAxisViews=[],this._timePoint=[],this._points=[],this._lastPoint=null,this._paneViews=new Map,this._normalizedPointsChanged=new(c()),this._fixedPointsChanged=new(c()),this._changeStatesStack=new O,this._startMovingPoint=null,this._currentMovingPoint=null,this._fixedPoints=[],this._isActualSymbol=!1,this._isActualInterval=!1,this._isActualCurrency=!1,this._isActualUnit=!1,this._isDestroyed=!1,this._sharingMode=new(A())(0),this._onTemplateApplying=new(c()),this._onTemplateApplied=new(c()),this._syncStateExclusions=[],this._definitionsViewModel=null,this._syncLineStyleMuted=!1,this._onIsActualIntervalChange=new(c()),this._linkKey=new(A())(null),this._serverUpdateTime=null,this._boundCalcIsActualSymbol=this.calcIsActualSymbol.bind(this),this._alertUndoMode=!1,this._model=e,this._properties=t,this._localAndServerAlertsMismatch=!1,
this._properties.hasChild("interval")||this._properties.addChild("interval",new(p())(e.mainSeries().interval())),this.calcIsActualSymbol(),this._properties.childs().intervalsVisibilities.listeners().subscribe(this,this.calcIsActualSymbol),this._properties.subscribe(this,(()=>this.propertiesChanged())),this._createPointsProperties(),this.pointsCount()>0)for(let e=0;e<this.pointsCount();e++)this._priceAxisViews.push(this.createPriceAxisView(e)),this._timeAxisViews.push(new m.LineDataSourceTimeAxisView(this,e));this._properties.childs().visible.subscribe(this,(e=>{const t=!1===(0,d.hideAllDrawings)().value();e.value()?e.value()&&t&&r.emit("drawing_event",this._id,"show"):(this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>{e.removeSourceFromSelection(this)})),t&&r.emit("drawing_event",this._id,"hide")),this._onSourceHiddenMayChange()})),(0,d.hideAllDrawings)().subscribe(this,this._onSourceHiddenMayChange),this._definitionsViewModel=null,this._isDestroyed=!1}destroy(){this._paneViews.forEach(((e,t)=>this._destroyPanePaneViews(t))),this.stop(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this),(0,E.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol))),this.ownerSourceChanged().unsubscribeAll(this),(0,d.hideAllDrawings)().unsubscribeAll(this),this.deleteAlert(),this._isDestroyed=!0}priceScale(){return this._ownerSource?this._ownerSource.priceScale():null}createPriceAxisView(e){return new _.LineToolPriceAxisView(this,{pointIndex:e})}model(){return this._model}symbol(){return this._properties.childs().symbol.value()}linkKey(){return this._linkKey}serverUpdateTime(){return this._serverUpdateTime}setServerUpdateTime(e){this._serverUpdateTime=e}boundToSymbol(){return!0}isAvailableInFloatingWidget(){return!0}points(){const e=[];for(let t=0;t<this._points.length;t++){const i=this._points[t];e.push({index:i.index,price:i.price,time:i.time})}return this._lastPoint&&e.push(this._correctLastPoint(this._lastPoint)),!this.isFixed()&&this._currentMovingPoint&&this._startMovingPoint&&this._correctPoints(e),e}timeAxisPoints(){return this.points()}priceAxisPoints(){return this.points()}fixedPoints(){const e=[],t=this.priceScale();if(this._positionPercents&&null!==t&&!t.isEmpty())for(let i=0;i<this._positionPercents.length;i++){const s=this._positionPercents[i],r=this._model.timeScale().width()*s.x,o=t.height()*s.y;e.push(new n.Point(r,o))}else for(let t=0;t<this._fixedPoints.length;t++)e.push(this._fixedPoints[t].clone());return this._currentMovingPoint&&this._startMovingPoint&&this._correctFixedPoints(e),e}normalizedPoints(){return this._timePoint}normalizedPointsChanged(){return this._normalizedPointsChanged}fixedPointsChanged(){return this._fixedPointsChanged}geometry(){
const e=(0,s.ensureNotNull)(this.priceScale());return this.points().map((t=>{const i=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),r=i.x/this._model.timeScale().width(),o=i.y/e.height();return new n.Point(r,o)}))}widthsProperty(){var e;return null!==(e=this._properties.childs().linesWidths)&&void 0!==e?e:null}lineColorsProperty(){var e;return null!==(e=this._properties.childs().linesColors)&&void 0!==e?e:null}backgroundColorsProperty(){var e;return null!==(e=this._properties.childs().backgroundsColors)&&void 0!==e?e:null}textColorsProperty(){var e;return null!==(e=this._properties.childs().textsColors)&&void 0!==e?e:null}pointsProperty(){return this._pointsProperty}hasEditableCoordinates(){return!0}startMoving(e,t,i,n){this.isFixed()&&this.restoreFixedPoints(),this._startMovingPoint=e}move(e,t,i,n){if(i&&(i.shiftOnly()||i.modShift()))if(this.isFixed()){const t=this._alignScreenPointHorizontallyOrVertically((0,s.ensureDefined)(e.screen));this._currentMovingPoint={screen:t}}else{const t=this._alignPointHorizontallyOrVertically((0,s.ensureDefined)(e.logical)),i=(0,s.ensureNotNull)(this.pointToScreenPoint(t));this._currentMovingPoint={logical:t,screen:i}}else this._currentMovingPoint=e;this.updateAllViews((0,k.sourceChangeEvent)(this.id()))}endMoving(e,t,i){let n=!1,o=!1;if(this._currentMovingPoint&&this._startMovingPoint){if(this.isFixed())this._correctFixedPoints(this._fixedPoints)&&this._fixedPointsChanged.fire();else{const e=(0,s.ensureDefined)(this._currentMovingPoint.logical),t=(0,s.ensureDefined)(this._startMovingPoint.logical);n=e.index!==t.index,o=e.price!==t.price;if(this._correctPoints(this._points,i)){r.emit("drawing_event",this._id,"move"),r.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._points.length;e++)this._pointChanged.fire(e)}}this._startMovingPoint=null,this._currentMovingPoint=null}const l={indexesChanged:n,pricesChanged:o};return this.isFixed()?(this.calcPositionPercents(),this.updateAllViews((0,k.sourceChangeEvent)(this.id())),l):(this.updateAllViews((0,k.sourceChangeEvent)(this.id())),n&&!e?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),t||!o&&!n||this.synchronizeAlert(!this._alertUndoMode),l)}startMovingPoint(){return this._startMovingPoint?{...this._startMovingPoint}:null}currentMovingPoint(){return this._currentMovingPoint?{...this._currentMovingPoint}:null}startChanging(e,t){void 0!==e&&void 0!==t&&(e<this._priceAxisViews.length&&this._priceAxisViews[e].setActive(!0),e<this._timeAxisViews.length&&this._timeAxisViews[e].setActive(!0)),this._changeStatesStack.start(this.points())}endChanging(e,t,i){const n=this._changeStatesStack.finish(this.points());n.indexesChanged&&this._changeStatesStack.isEmpty()?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),t||this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),
r.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._priceAxisViews.length;e++)this._priceAxisViews[e].setActive(!1);for(let e=0;e<this._timeAxisViews.length;e++)this._timeAxisViews[e].setActive(!1);return i||this.synchronizeAlert(!e),n}setPoint(e,t,i,n){if(i&&i.shift()&&this._snapTo45DegreesAvailable()){const i=0===e?1:e-1;this._snapPoint45Degree(t,this.points()[i])}this._setPoint(e,t)}getPoint(e){return this.points()[e]||null}alignCrossHairToAnchor(e){return!0}setLastPoint(e,t){return this._lastPoint=this._preparePoint(e,t),this.updateAllViews((0,k.sourceChangeEvent)(this.id())),this._lastPoint}lastPoint(){return this._lastPoint}getChangePointForSync(e){return this.getPoint(e)}setPoints(e){this._points=e}isForcedDrawPriceAxisLabel(){return this.customization.forcePriceAxisLabel}clearData(){this._points=[]}denormalizeTimePoints(){let e=[];for(let t=0;t<this._timePoint.length;t++){const i=this._model.timeScale().denormalizeTimePoint(this._timePoint[t]);if(void 0===i){e=[];break}e.push({index:i,price:this._timePoint[t].price})}e.length>0&&(this._points=e)}restorePoints(e,t,i){const n=this._timePoint.length>0&&!(0,V.deepEquals)(this._timePoint,e)[0];this._timePoint=(0,y.deepCopy)(e),this._points=t,i||this.denormalizeTimePoints(),n&&this._normalizedPointsChanged.fire()}restorePositionPercents(e){this._positionPercents=e}calcIsActualSymbol(){const e=this.ownerSource();if(null===e)this._isActualSymbol=!1;else{const t=(0,s.ensureNotNull)(e.symbolSource());this._migrateSymbolProperty();const i=this._properties.childs().symbol,n=i.value();if(this._isActualSymbol=t.symbolSameAsCurrent(n),this._isActualSymbol){const e=t.symbol();(0,S.areEqualSymbols)(n,e)||(F.logWarn('Possible drawing "migrating" detected from "'+n+'" to "'+e+'"'),F.logWarn("Series symbolInfo: "+JSON.stringify(t.symbolInfo())),F.logWarn(`${(new Error).stack}`)),i.setValue(e)}}this.calcIsActualInterval(),this.calcIsActualCurrency(),this.calcIsActualUnit(),this._onSourceHiddenMayChange()}calcIsActualCurrency(){const e=this.ownerSource();if(null===e)return void(this._isActualCurrency=!1);let t=this._properties.childs().currencyId.value();if(null!==t){const i=e.symbolSource();"pct"===t&&(this._properties.childs().currencyId.setValue(null),t=null),this._isActualCurrency=t===(0,P.symbolCurrency)(i.symbolInfo(),void 0,!0)}else{const t=(0,s.ensureNotNull)(e.symbolSource()).symbolInfo();this._isActualCurrency=null!==t&&(0,P.symbolCurrency)(t)===(0,P.symbolOriginalCurrency)(t)}this._onSourceHiddenMayChange()}calcIsActualUnit(){const e=this.ownerSource();if(null===e)return void(this._isActualUnit=!1);const t=this._properties.childs().unitId.value();if(null!==t)this._isActualUnit=t===(0,s.ensureNotNull)(e.symbolSource()).unit();else{const t=(0,s.ensureNotNull)(e.symbolSource()).symbolInfo(),i=this._model.unitConversionEnabled();this._isActualUnit=null!==t&&(0,P.symbolUnit)(t,i)===(0,P.symbolOriginalUnit)(t,i)}this._onSourceHiddenMayChange()}calcIsActualInterval(){const e=this._isActualInterval,t=this._properties,i=this._model.mainSeries()
;this._isActualInterval=(0,L.isActualInterval)(b.Interval.parse(i.interval()),t.childs().intervalsVisibilities),!this._isActualInterval&&this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>e.removeSourceFromSelection(this))),this._isActualInterval!==e&&this._onIsActualIntervalChange.fire(),this._onSourceHiddenMayChange()}paneViews(e){if(this.isSourceHidden())return null;const t=this._getPaneViews(this.isMultiPaneAvailable()?e:void 0);if(null===t)return null;if(1===t.length)return[t[0]];const i=[];for(let e=t.length-1;e>=0;--e)i.push(t[e]);return i}priceAxisViews(e,t){if(t!==this.priceScale()||this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._priceAxisViews.length){const t=this._priceAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._priceAxisViews}return this._priceAxisViews}timeAxisViews(){if(this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._timeAxisViews.length){const t=this._timeAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._timeAxisViews}return this._timeAxisViews}isSavedInChart(){return!this.customization.disableSave}isSavedInStudyTemplates(){return!1}setSavingInChartEnabled(e){this.customization.disableSave=!e}shouldBeRemovedOnDeselect(){return!1}getOrderTemplate(){return null}getSourceIcon(){return{type:"loadSvg",svgId:"linetool."+this.toolname}}alertId(){return this._alertId}setAlert(e,t){const i=t&&t.sync;return this.canHasAlert()?(this._alertId=e,this.hasAlert.setValue(!0),this.getAlert().then((e=>{const t=this._model.selection().isSelected(this);return e?(this._removeAlertSubscriptions(),this._addAlertSubscriptions(e),e.setSelected(t),this._onAlertData(e),e):(F.logError("Failed to get alert, alert will not be saved with drawing in chart"),Promise.reject("got_no_alert"))})).then((()=>{const t=this.linkKey().value();null===t||i||(0,d.changeLineStyle)({linkKey:t,model:this._model,state:{},alertId:e})})).catch((t=>{this._removeAlertSubscriptions(),"not_exists"===t?(0,x.getChartAlertsFacade)().then((t=>{t.removeAlertFromAllChartsSilently(this.id(),e)})):F.logError("Getting alert or Saving chart failed: "+t)}))):Promise.reject("Line data source can not has alert")}editAlert(e){this.hasAlert.value()&&(0,x.getChartAlertsFacade)().then((t=>{t.openEditDialog((0,s.ensureDefined)(this._alertId),{actionSource:e,error:e=>{"not_exists"===e&&this.removeAlert()}})}))}getAlert(){return new Promise((async(e,t)=>{(await(0,x.getChartAlertsFacade)()).getAlert((0,s.ensureDefined)(this._alertId),{success:e,error:t})}))}getAlertSync(){var e;if(!this._alertId)return null;const t=(0,x.getChartAlertsFacadeIfCreatedBefore)();return null===t?null:null!==(e=t.getAlertSync(this._alertId))&&void 0!==e?e:null}synchronizeAlert(e){this.hasAlert.value()&&setTimeout((()=>{this._isDestroyed||this._synchronizeAlert(e)}),0)}syncAlert(e){this.hasAlert.value()||this.setAlert(e,{sync:!0})}stateForAlert(){
if(!this.canHasAlert())return null;const e={...this.state(),id:this.idForAlert(),uniqueId:this.idForAlert(),title:this.translatedType(),interval:this._model.mainSeries().interval()},t=this._getAlertPlots();return t&&t.length>0&&(e.plots=t),e}getAlertIsActive(){if(!this._alertId)return!1;const e=this.getAlertSync();return Boolean(e&&e.isActive())}detachAlert(){this._removeAlertSubscriptions(),this.hasAlert.setValue(!1),this._alertId=void 0}removeAlert(){this._alertId=void 0,this.hasAlert.setValue(!1),this._removeAlertSubscriptions()}deleteAlert(){if(!this.hasAlert.value()||void 0===this._alertId)return;const e=(0,x.getChartAlertsFacadeIfCreatedBefore)();e&&e.deleteAlert(this._alertId),this.removeAlert()}areLocalAndServerAlertsMismatch(){return this._localAndServerAlertsMismatch}showInObjectTree(){return this.customization.showInObjectsTree}setShowInObjectsTreeEnabled(e){this.customization.showInObjectsTree=e}start(){this.createServerPoints()}processHibernate(){this.isSourceHidden()?this.isStarted()&&this.stop():this.isStarted()||this.start()}onData(e){"pointset_error"!==e.method?e.params.customId===this._currentPointsetIdWithPrefix()&&this._onPointsetUpdated(e.params.plots):F.logError(`Error getting pointset: ${e.params[0]} ${e.params[1]}`)}isBeingEdited(){return this===this._model.lineBeingEdited()}isActualSymbol(){return this._isActualSymbol}isActualCurrency(){return this._isActualCurrency}isActualInterval(){return this._isActualInterval}isActualUnit(){return this._isActualUnit}onIsActualIntervalChange(){return this._onIsActualIntervalChange}setOwnerSource(e){null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),null!==this._ownerSource&&(0,E.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().unsubscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol)),super.setOwnerSource(e),e&&(this.setPriceScale(e.priceScale()),e.currencyChanged().subscribe(this,this.calcIsActualCurrency),e.unitChanged().subscribe(this,this.calcIsActualUnit),this.calcIsActualSymbol(),this._migrateZOrder()),(0,E.isSymbolSource)(e)&&(e.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),e.isActingAsSymbolSource().subscribe(this._boundCalcIsActualSymbol))}dataAndViewsReady(){return this._paneViews.size>0}pointAdded(){return this._pointAdded}pointChanged(){return this._pointChanged}pointToScreenPoint(e){var t;const i=this._model.timeScale(),s=this.priceScale(),r=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(!s||s.isEmpty()||i.isEmpty()||null==r)return null;const o=i.indexToCoordinate(e.index),l=s.priceToCoordinate(e.price,r);return new n.Point(o,l)}screenPointToPoint(e){var t;const i=this.priceScale(),n=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(null==n||!isFinite(n)||null===i)return null;const s=this._model.timeScale().coordinateToIndex(e.x);return{price:i.coordinateToPrice(e.y,n),index:s}}calcMiddlePoint(e,t){
return new n.Point((e.x+t.x)/2,(e.y+t.y)/2)}addPoint(e,t,i){const n=this._preparePoint(e,t);return this._addPointIntenal(n,t,i)}addFixedPoint(e){this._fixedPoints.push(e);const t=this._fixedPoints.length===this.pointsCount();return t&&this.calcPositionPercents(),t}calcPositionPercents(){const e=this.priceScale();if(!e||e.isEmpty())return[];this._positionPercents=[];for(let t=0;t<this._fixedPoints.length;t++){const i=this._fixedPoints[t],n=i.x/this._model.timeScale().width(),s=i.y/e.height();this._positionPercents.push({x:n,y:s})}return this._positionPercents}restoreFixedPoints(){this._fixedPoints=this.fixedPoints()}getPointByPosition(e,t,i,n){return[t,i,n][e]}propertiesChanged(e){this.calcIsActualInterval(),this.updateAllViewsAndRedraw((0,k.sourceChangeEvent)(this.id())),e||this._syncLineStyleIfNeeded(),void 0===this._pendingPropertyChangedEvent&&(this._pendingPropertyChangedEvent=setTimeout((()=>{this._pendingPropertyChangedEvent=void 0,r.emit("drawing_event",this._id,"properties_changed")}),0))}state(e){var t,i;const n={type:this.toolname,id:this.id(),state:this.properties().state(null!==(t=this._propertiesStateExclusions())&&void 0!==t?t:void 0),points:(0,y.deepCopy)(this._timePoint),zorder:this.zorder(),ownerSource:null===(i=this.ownerSource())||void 0===i?void 0:i.id()};return this.linkKey().value()&&(n.linkKey=this.linkKey().value()),0!==this._sharingMode.value()&&(n.sharingMode=this._sharingMode.value()),delete n.state.points,e&&(n.indexes=this._points),this.isFixed()&&(n.positionPercents=this._positionPercents||this.calcPositionPercents()),"version"in this&&1!==this.version&&(n.version=this.version),this._saveAlertIdInState()&&this.hasAlert.value()&&void 0!==this._alertId&&(n.alertId=this._alertId),n}updateAllViews(e){this._isActualSymbol&&this._isActualCurrency&&this._isActualUnit&&this._isActualInterval&&this._properties.childs().visible.value()&&(this._updateAllPaneViews(e),this._priceAxisViews.forEach((t=>t.update(e))),this._timeAxisViews.forEach((t=>t.update(e))))}updateAllViewsAndRedraw(e){this.updateAllViews(e),this._model.updateSource(this)}tags(){return[this.toolname]}properties(){return this._properties}restoreExternalPoints(e,t){if(this._timePoint=(0,y.deepCopy)(e.points),t.indexesChanged){if(this.properties().childs().interval.setValue(e.interval),!this.isActualSymbol())return this._clearServerPoints(),void this._normalizedPointsChanged.fire();this.createServerPoints()}else{const t=Math.min(this._points.length,e.points.length);for(let i=0;i<t;i++)this._points[i].price=e.points[i].price}this._normalizedPointsChanged.fire()}restoreExternalState(e){this.properties().mergeAndFire(e)}applyTemplate(e){this._onTemplateApplying.fire(e),this._applyTemplateImpl(e),this.calcIsActualSymbol(),this.updateAllViews((0,k.sourceChangeEvent)(this.id())),this.model().lightUpdate(),this._onTemplateApplied.fire()}template(){return this.properties().preferences()}isFixed(){return!1}isLocked(){const e=this.properties().child("frozen");return void 0!==e&&e.value()}isSourceHidden(){
return!this._properties.childs().visible.value()||(0,d.hideAllDrawings)().value()&&this.canBeHidden()||!this._isActualInterval||!this._isActualSymbol||!this._isActualCurrency||!this._isActualUnit}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}copiable(){return z}cloneable(){return null!==this._ownerSource&&null!==this._ownerSource.firstValue()}movable(){return!0}async getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const e=await this._getPropertyDefinitionsViewModelClass();return null===e||this._isDestroyed?null:(this._definitionsViewModel=new e(this._model.undoModel(),this),this._definitionsViewModel)}return this._definitionsViewModel}title(){return this.translatedType()}translatedType(){var e;return null!==(e=N.lineToolsLocalizedNames[this.toolname])&&void 0!==e?e:"Line Tool"}name(){return"Line Tool"}createServerPoints(){if(!this._isActualSymbol)return;if(!this._model.chartApi().isConnected().value())return;if(this._clearServerPoints(),this._model.timeScale().isEmpty())return;if(0===this._timePoint.length&&this._points.length>0&&this.normalizePoints(),!this._readyToCreatePointset())return;const e=this._pointsForPointset();if(0===e.length)return;++H,this._currentPointsetAndSymbolId={pointsetId:H,symbolId:(0,s.ensureNotNull)(this._model.mainSeries().seriesSource().symbolInstanceId())};const t=(0,M.getServerInterval)(this.properties().childs().interval.value());this._model.chartApi().createPointset(this._currentPointsetIdWithPrefix(),"turnaround",this._currentPointsetAndSymbolId.symbolId,t,e,this.onData.bind(this))}finish(){}realign(){var e;this.calcIsActualSymbol(),this.isFixed()||this.isSourceHidden()||this._model.lineBeingCreated()===this||this._model.lineBeingEdited()===this||(null===(e=this._currentPointsetAndSymbolId)||void 0===e?void 0:e.symbolId)===this._model.mainSeries().seriesSource().symbolInstanceId()||this._clearServerPoints(),this.updateAllViews((0,k.sourceChangeEvent)(this.id()))}stop(){this._clearServerPoints()}restart(){this.isFixed()||(this._currentPointsetAndSymbolId=null,this.createServerPoints())}isStarted(){return null!==this._currentPointsetAndSymbolId}convertYCoordinateToPriceForMoving(e,t){var i;const n=(0,s.ensureNotNull)(this.priceScale());if(n.isEmpty())return null;const r=this.ownerSource(),o=(0,s.ensure)(null===(i=r||t)||void 0===i?void 0:i.firstValue());return n.coordinateToPrice(e,o)}syncMultichartState(e){const t={points:this._timePoint,interval:this._model.mainSeries().interval()},i=this.linkKey().value();if(null!==i&&this.isSynchronizable()){const n={model:this._model,linkKey:i,symbol:this._model.mainSeries().symbol(),finalState:t,changes:e};(0,d.finishChangingLineTool)(n)}}enableCurrentIntervalVisibility(){const e=this.properties().childs().intervalsVisibilities.state();void 0!==e&&((0,L.makeIntervalsVisibilitiesVisibleAtInterval)(e,b.Interval.parse(this._model.mainSeries().interval())),this.properties().childs().intervalsVisibilities.mergeAndFire(e))}clonePositionOffset(){return this.isFixed()?{barOffset:0,
xCoordOffset:20,yCoordOffset:20}:{barOffset:0,xCoordOffset:0,yCoordOffset:-40}}sharingMode(){return this._sharingMode}share(e){this.isSynchronizable()&&this._sharingMode.setValue(e)}syncLineStyleState(){const e=this.properties().state(this._syncStateExclusions);return delete e.interval,e.intervalsVisibilities=(0,L.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities),e}moveLineTool(e){e.forEach(((e,t)=>this._setPoint(t,e))),this.normalizePoints()}_setPoint(e,t){this._points[e].index===t.index?this._points[e].price=t.price:this._points[e]=t,this._pointChanged.fire(e)}_correctLastPoint(e){return(0,V.clone)(e)}_pointsForPointset(){return this._timePoint.map((e=>[e.time_t,e.offset]))}_snapPoint45Degree(e,t,i){const n=this._model.timeScale(),r=n.indexToCoordinate(t.index),o=n.indexToCoordinate(e.index)-r,l=(0,s.ensureNotNull)(this.priceScale()),a=t.price,d=e.price,u=(0,s.ensureNotNull)((0,s.ensureNotNull)(this.ownerSource()).firstValue()),c=l.priceToCoordinate(a,u),h=l.priceToCoordinate(d,u)-c,p=Math.round(Math.atan2(o,h)/Math.PI*4);if(2===Math.abs(p))i||(e.price=a);else if(0===Math.abs(p)||4===Math.abs(p))i||(e.index=t.index);else{const t=Math.sqrt(o*o+h*h),i=o<0?-1:1,s=h<0?-1:1;let a=Math.max(Math.abs(h),Math.abs(o));a/=a*Math.sqrt(2)/t;const d=Math.round(n.coordinateToIndex(r+a*i)),p=Math.abs(n.indexToCoordinate(d)-r),v=l.coordinateToPrice(c+p*s,u);e.index=d,e.price=v}}normalizePoint(e){return{...this._model.timeScale().normalizeBarIndex(e.index),price:e.price}}normalizePoints(){this._timePoint=[];for(let e=0;e<this._points.length;e++)if(void 0!==this._points[e].index){const t=this.normalizePoint(this._points[e]);if(!t.time_t){this._timePoint=[];break}this._timePoint.push(t)}this._normalizedPointsChanged.fire()}_setPaneViews(e,t,i){if(this._isDestroyed)for(const t of e)t.destroy&&t.destroy();else this._paneViews.set(t,e),void 0!==t&&i&&t.onDestroyed().subscribe(this,(()=>this._destroyPanePaneViews(t))),this._model.lightUpdate()}_getPaneViews(e){return this._paneViews.get(e)||null}_updateAllPaneViews(e){this._paneViews.forEach((t=>{for(const i of t)i.update(e)}))}_alignPointHorizontallyOrVertically(e){const t=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,s.ensureDefined)((0,s.ensureNotNull)(this._startMovingPoint).logical),n=(0,s.ensureDefined)((0,s.ensureNotNull)(this._startMovingPoint).screen),r=Math.abs(n.x-t.x),o=Math.abs(n.y-t.y);if(r<10&&o<10)return e;return{index:r<o?i.index:e.index,price:r<o?e.price:i.price}}_alignScreenPointHorizontallyOrVertically(e){const t=(0,s.ensureDefined)((0,s.ensureNotNull)(this._startMovingPoint).screen),i=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return i<10&&r<10?e:i<r?new n.Point(t.x,e.y):new n.Point(e.x,t.y)}_correctPoints(e,t){const i=(0,s.ensureDefined)((0,s.ensureNotNull)(this._currentMovingPoint).screen),n=(0,s.ensureDefined)((0,s.ensureNotNull)(this._startMovingPoint).screen),r=i.subtract(n);if(r.length()<1&&!t)return!1;for(let t=0;t<e.length;t++){const i=e[t],n=(0,s.ensureNotNull)(this.pointToScreenPoint(i)).add(r),o=(0,s.ensureNotNull)(this.screenPointToPoint(n))
;e[t].index=o.index,e[t].price=o.price}return!0}_correctFixedPoints(e){const t=(0,s.ensureDefined)((0,s.ensureNotNull)(this._currentMovingPoint).screen),i=(0,s.ensureDefined)((0,s.ensureNotNull)(this._startMovingPoint).screen),n=t.subtract(i);if(n.length()>=1){for(let t=0;t<e.length;t++)e[t]=e[t].add(n);return!0}return!1}_currentPointsetIdWithPrefix(){return"pointset_"+(0,s.ensureNotNull)(this._currentPointsetAndSymbolId).pointsetId}_clearServerPoints(){null!==this._currentPointsetAndSymbolId&&this._model.chartApi().isConnected().value()&&this._model.chartApi().removePointset(this._currentPointsetIdWithPrefix()),this._currentPointsetAndSymbolId=null}_createPointProperty(e){const t=this._pointsProperty.childs().points;t.addProperty(""+e,{});const i=t[e];i.addChild("price",new f(this,e)),i.addChild("bar",new g.LineDataSourcePointIndexProperty(this,e))}_createPointsProperties(){this._pointsProperty=new(p()),this._pointsProperty.addChild("points",new(p()));for(let e=0;e<this.pointsCount();e++)this._createPointProperty(e)}_alignPointToRangeOfActualData(e){const t=(0,s.ensureNotNull)(this._model.mainSeries().bars().firstIndex()),i=(0,s.ensureNotNull)(this._model.mainSeries().bars().lastIndex());let n=Math.max(e.index,t);return n=Math.min(n,i),{...e,index:n}}_migrateSymbolProperty(){const e=this._properties.childs();if(e.symbolStateVersion.value()<2){const t=(0,s.ensureNotNull)(this.ownerSource()),i=(0,s.ensureNotNull)(t.symbolSource()),n=this._model.mainSeries();if(i===n)return void e.symbolStateVersion.setValueSilently(2);if(null===n.symbolInfo())return;if(null===i.symbolInfo())return;n.symbolSameAsCurrent(e.symbol.value())&&e.symbol.setValueSilently(i.symbol()),e.symbolStateVersion.setValueSilently(2)}}_migrateZOrder(){const e=this._properties.childs();e.zOrderVersion.value()<2&&(this.ownerSource()===this.model().mainSeries()&&this.setZorder(this.zorder()-this.model().mainSeries().obsoleteZOrder()),e.zOrderVersion.setValueSilently(2))}_preparePoint(e,t){const i=e;return t&&t.shift()&&this.points().length>=2&&this._snapTo45DegreesAvailable()&&this._snapPoint45Degree(i,this.points()[this.points().length-2]),i}_addPointIntenal(e,t,i){this._points.push(e);const n=this._points.length===this.pointsCount();return n?(this._lastPoint=null,i||(this.normalizePoints(),this.createServerPoints())):this._lastPoint=e,this._pointAdded.fire(this._points.length-1),n}_onSourceHiddenMayChange(){this._model.invalidate(I.InvalidationMask.validateAction((()=>{this!==this._model.lineBeingCreated()&&(this._isDestroyed||this.processHibernate())})))}_saveAlertIdInState(){return!0}_onPointsetUpdated(e){if(0!==e.length){for(let t=0;t<e.length;t++){const i=e[t],n=this._timePoint[i.index],s={index:i.value[0],time:new Date(1e3*i.value[1]),price:n.price};this._points.length<=i.index?(this._points.push(s),this._pointAdded.fire(this._points.length-1)):(this._points[i.index]=s,this._pointChanged.fire(i.index))}{const e=this;e.recalculateStateByData&&e.recalculateStateByData()}this.updateAllViewsAndRedraw((0,k.sourceChangeEvent)(this.id()))}}
_snapTo45DegreesAvailable(){return!1}_onMainSeriesSymbolResolved(){const e=this.ownerSource();null===e||this._model.mainSeries()===e.symbolSource()||this.isSourceHidden()||this.createServerPoints()}_readyToCreatePointset(){return this._timePoint.length>0}_onAlertData(e){}_propertiesStateExclusions(){return null}_syncLineStyleIfNeeded(){const e=this.linkKey().value();!this._syncLineStyleMuted&&e&&(0,d.changeLineStyle)({linkKey:e,state:this.syncLineStyleState(),model:this._model})}_muteSyncLineStyle(){this._syncLineStyleMuted=!0}_unmuteSyncLineStyleWithoutApplyingChanges(){this.propertiesChanged(),this._syncLineStyleMuted=!1}_applyTemplateImpl(e){e.intervalsVisibilities=(0,L.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities);const t=this.properties();t.mergePreferences(e),t.saveDefaults(),this.propertiesChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_getAlertPlots(){return[]}_getUndoHistory(){return this._model.undoModel().undoHistory()}_synchronizeAlert(e){const t=this._getUndoHistory();if(!this._undoCheckpointAlert&&!this._alertUndoMode){const e=t.undoStack().pop();this._undoCheckpointAlert=t.createUndoCheckpoint(),e&&t.undoStack().push(e)}const i=e=>{const t=e.description()!==e.defaultDescription(),i=(0,s.ensureNotNull)(e.seriesState()),n=this._model.mainSeries().stateForAlert();"MainSeries"===i.type&&n.actualSymbol===i.actualSymbol&&e.setSeriesState(n),e.setMainSeriesState(n),e.setSymbol(n.symbolString);const r=(0,s.ensureNotNull)(this.stateForAlert());e.setResolution(r.interval),e.setLineState(r),t||e.resetToDefaultDescription(),this._localAndServerAlertsMismatch=!0},n=()=>{this._alertUndoMode=!0,t.undoToCheckpoint((0,s.ensureDefined)(this._undoCheckpointAlert)),setTimeout((()=>{this._alertUndoMode=!1,this._localAndServerAlertsMismatch=!1}),0)},r=e=>{"not_exists"!==e&&(F.logError("Getting alert failed: "+e),n())},o=async e=>{(await(0,x.getChartAlertsFacade)()).restartAlert(e,{success:()=>this._localAndServerAlertsMismatch=!1,error:r,complete:()=>delete this._undoCheckpointAlert,actionSource:"drawing_sync"})};(0,T.canPlaceAlertOnResolution)(this.stateForAlert().interval)?this.getAlert().then((t=>{t?(i(t),e&&(o(t),this._onAlertData(t))):F.logError("Failed to get alert, drawing and alert are not synchronized")})).catch(r):this._alertUndoMode||((0,w.showGoProAlertsOnSecondsDialog)(),n(),delete this._undoCheckpointAlert)}_linePointsToAlertPlot(e,t,i,n){if(2!==e.length)return F.logError("[Drawing Alert] Wrong points"),null;const r=this._model.timeScale();return!r||r.isEmpty()?null:{type:"LinePlot",title:t||this.translatedType(),timestamp:(0,s.ensureNotNull)(r.indexToTimePoint(0)),offset1:e[0].index,offset2:e[1].index,price1:e[0].price,price2:e[1].price,extendBackward:i||!1,extendForward:n||!1}}static _configureProperties(e){if(B._addCollectedProperties(e),e.hasChild("symbolStateVersion")||e.addChild("symbolStateVersion",new(p())(1)),e.hasChild("zOrderVersion")||e.addChild("zOrderVersion",new(p())(1)),e.hasChild("visible")||e.addChild("visible",new(p())(!0)),
e.hasChild("frozen")||e.addChild("frozen",new(p())(!1)),e.hasChild("symbol")||e.addChild("symbol",new(p())("")),e.hasChild("currencyId")||e.addChild("currencyId",new(p())(null)),e.hasChild("unitId")||e.addChild("unitId",new(p())(null)),e.addExclusion("symbolStateVersion"),e.addExclusion("zOrderVersion"),e.addExclusion("visible"),e.addExclusion("frozen"),e.addExclusion("symbol"),e.addExclusion("currencyId"),e.addExclusion("unitId"),e.hasChild("intervalsVisibilities")){const t=(0,V.merge)((0,V.clone)(R.intervalsVisibilitiesDefaults),e.childs().intervalsVisibilities.state());e.removeProperty("intervalsVisibilities"),e.addChild("intervalsVisibilities",new D.IntervalsVisibilitiesProperty(t))}else e.addChild("intervalsVisibilities",new D.IntervalsVisibilitiesProperty(R.intervalsVisibilitiesDefaults));e.hasChild("title")||e.addChild("title",new(p())("")),e.addExclusion("symbolInfo"),e.addExclusion("points"),e.addExclusion("interval"),e.addExclusion("title"),e.hasChild("singleChartOnly")&&e.removeProperty("singleChartOnly"),e.hasChild("font")&&e.removeProperty("font")}static _addCollectedProperties(e){e.hasChild("linewidth")&&e.addChild("linesWidths",new v.LineToolWidthsProperty([(0,s.ensureDefined)(e.child("linewidth"))])),e.hasChild("linecolor")&&e.addChild("linesColors",new v.LineToolColorsProperty([(0,s.ensureDefined)(e.child("linecolor"))])),e.hasChild("backgroundColor")&&e.addChild("backgroundsColors",new v.LineToolColorsProperty([(0,s.ensureDefined)(e.child("backgroundColor"))])),e.hasChild("textColor")&&e.addChild("textsColors",new v.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textColor"))])),e.addExclusion("linesWidths"),e.addExclusion("linesColors"),e.addExclusion("backgroundsColors"),e.addExclusion("textsColors")}_removeAlertSubscriptions(){var e;null===(e=this._unsubscribeAlertCallbacks)||void 0===e||e.call(this),this._unsubscribeAlertCallbacks=void 0}_addAlertSubscriptions(e){if(void 0!==this._unsubscribeAlertCallbacks)return;const t=this.properties().child("extendLeft"),i=this.properties().child("extendRight"),n=e.destroyed().spawn(),s=e.selected().spawn(),r=e.hovered().spawn();n.subscribe(this.removeAlert.bind(this)),s.subscribe((e=>{this._model.selectionMacro((t=>{e?t.addSourceToSelection(this):t.removeSourceFromSelection(this)}))})),r.subscribe((e=>{const t=this._model.hoveredSource();e&&t!==this?this._model.setHoveredSource(this,null):e||t!==this||this._model.setHoveredSource(null,null)})),void 0!==t&&t.subscribe(this,(()=>this.synchronizeAlert(!1))),void 0!==i&&i.subscribe(this,(()=>this.synchronizeAlert(!1))),this._unsubscribeAlertCallbacks=()=>{n.destroy(),r.destroy(),s.destroy(),void 0!==t&&t.unsubscribeAll(this),void 0!==i&&i.unsubscribeAll(this)}}_destroyPanePaneViews(e){const t=this._paneViews.get(e);if(void 0!==t)for(const e of t)e.destroy&&e.destroy();void 0!==e&&e.onDestroyed().unsubscribeAll(this),this._paneViews.delete(e)}_copyPricesWithoutNormalization(){const e=Math.min(this._points.length,this._timePoint.length);for(let t=0;t<e;t++)this._timePoint[t].price=this._points[t].price}}},
241056:(e,t,i)=>{i.r(t),i.d(t,{LineToolMultiplePropertyBaseImpl:()=>a,LineToolCollectedProperty:()=>d,LineToolWidthsProperty:()=>u,LineToolColorsProperty:()=>c,MultipleLineWidthsProperty:()=>p,MultipleLineColorsProperty:()=>v});var n=i(272001),s=i(869403),r=i.n(s);const o=(0,n.getLogger)("Chart.LineToolCollectedProperty");class l{applyValue(e,t){e.setValue(t)}}class a{constructor(e,t){this._onChange=new(r()),this._properties=e,e.forEach((e=>e.subscribe(this,(()=>{this._onChange.fire(this)})))),this._showIfProperty=t}visible(){var e;return!this._showIfProperty||(null===(e=this._showIfProperty)||void 0===e?void 0:e.value())}value(){if(0===this._properties.length)return o.logError("Incorrect call, should not request value of 0 properties"),"mixed";const e=this._properties[0].value();return 1===this._properties.length||this._properties.every((t=>t.value()===e))?e:"mixed"}state(){}merge(){}destroy(){this._properties.forEach((e=>e.unsubscribeAll(this)))}subscribe(e,t){this._onChange.subscribe(e,t)}unsubscribe(e,t){this._onChange.unsubscribe(e,t)}unsubscribeAll(e){this._onChange.unsubscribeAll(e)}storeStateIfUndefined(){return!0}}class d extends a{setValue(e,t,i){if("mixed"===e)return;const n=null!=i?i:new l;this._properties.forEach((t=>n.applyValue(t,e)))}}class u extends d{}class c extends d{firstColor(){return this._properties[0].value()}}class h extends a{setValue(e,t,i){if("mixed"===e)return;const n=null!=i?i:new l;this._properties.forEach((t=>t.setValue(e,void 0,n)))}}class p extends h{}class v extends h{}},343135:(e,t,i)=>{i.d(t,{LineToolWithRelativePriceCoordinate:()=>l});var n=i(650151),s=i(892142),r=i(796309),o=i(480071);class l extends s.LineDataSource{constructor(){super(...arguments),this._startMovingAnchorY=NaN}priceSource(){return this.ownerSource()}addPoint(e,t,i){return super.addPoint(this._updatePositionAndCorrectPoint(e),t,i)}setPoint(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!this.isPhantom()&&!this._allowChangeAnchorHorizontally()),i),this._syncPosition()}setPointAndChangeIndex(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!1),i),this._syncPosition()}startMoving(e,t,i,s){s||(this._startMovingAnchorY=(0,n.ensureNotNull)(this._anchorYCoordinate())),super.startMoving(e,t,i)}move(e,t,i,s){var r;const o=(0,n.ensureDefined)((0,n.ensureNotNull)(this.startMovingPoint()).logical),l=(0,n.ensureDefined)(e.logical);if(!s&&0===t){const e=this._points[0],t=l.index-o.index,i=(0,n.ensureNotNull)(this.priceScale()),s=(0,n.ensure)(null===(r=this.ownerSource())||void 0===r?void 0:r.firstValue()),a=i.priceToCoordinate(l.price,s)-i.priceToCoordinate(o.price,s),d=this._startMovingAnchorY+a,u=i.coordinateToPrice(d,s);this._updatePositionAndCorrectPoint({index:e.index+t,price:u})}super.move(e,t,i),s||this._syncPosition()}_allowChangeAnchorHorizontally(){return!1}_updatePositionAndCorrectPoint(e,t){t&&(e.index=this._points[0].index);const i=this.priceSource();if(null===i)return e;const n=i.priceScale(),s=i.firstValue();if(null===n||n.isEmpty()||null===s)return e;const o=n.height()
;let l=o/2,a=e.price>=n.coordinateToPrice(l,s)?1:-1;const d=this._model.mainSeries();if(i===d){const t=d.data().search(this._baseSeriesIndexForPoint(e));if(null!==t){const i=(0,r.seriesPrice)(d,t,-1),o=(0,r.seriesPrice)(d,t,1);a=e.price>=i?1:-1,l=n.priceToCoordinate(1===a?o:i,s),e.price=1===a?Math.max(o,e.price):e.price}}const u=1===(-1===a!==n.isInverted()?-1:1)?l:o-l,c=n.priceToCoordinate(e.price,s),h=Math.min(o,Math.abs(c-l)),p=Math.max(0,Math.min(100,100*h/u))*a;return this.properties().childs().position.setValue(p),e}_baseSeriesIndexForPoint(e){return e.index}_syncPosition(){const e=this.linkKey().value();if(null!==e){const t={position:this.properties().childs().position.value()};(0,o.changeLineStyle)({linkKey:e,state:t,model:this._model})}}_anchorYCoordinate(){const e=this.priceSource();if(null===e)return null;const t=e.priceScale(),i=e.firstValue();if(null===t||t.isEmpty()||null===i)return null;const n=this._model.mainSeries(),s=this.customEvent();if(null===s)return null;let o=null;if(e===n&&(o=(0,r.seriesBasePosition)(n,s)),null===o&&(o=(0,r.noDataBasePosition)(s,t,i)),null===o)return null;const l=s.position(),a=t.priceToCoordinate(o.price,i);return(0,r.positionToCoordinate)(l,t.height(),a,(0,r.positionVisualDirection)(l,t.isInverted()))}}},51782:(e,t,i)=>{i.d(t,{lineToolsLocalizedNames:()=>r});var n=i(125226),s=i(777754);const r={LineTool5PointsPattern:s.t(null,void 0,i(566527)),LineToolABCD:s.t(null,void 0,i(532852)),LineToolArc:s.t(null,void 0,i(745104)),LineToolArrow:s.t(null,void 0,i(696237)),LineToolArrowMarkDown:s.t(null,void 0,i(908738)),LineToolArrowMarkLeft:s.t(null,void 0,i(835062)),LineToolArrowMarkRight:s.t(null,void 0,i(192163)),LineToolArrowMarkUp:s.t(null,void 0,i(633196)),LineToolBalloon:s.t(null,void 0,i(40664)),LineToolComment:s.t(null,void 0,i(119372)),LineToolBarsPattern:s.t(null,void 0,i(98838)),LineToolBezierCubic:s.t(null,void 0,i(59368)),LineToolBezierQuadro:s.t(null,void 0,i(517206)),LineToolBrush:s.t(null,void 0,i(530251)),LineToolCallout:s.t(null,void 0,i(764149)),LineToolCircleLines:s.t(null,void 0,i(587761)),LineToolCypherPattern:s.t(null,void 0,i(927891)),LineToolDateAndPriceRange:s.t(null,void 0,i(379859)),LineToolDateRange:s.t(null,void 0,i(660222)),LineToolDisjointAngle:s.t(null,void 0,i(603556)),LineToolElliottCorrection:s.t(null,void 0,i(291215)),LineToolElliottDoubleCombo:s.t(null,void 0,i(180983)),LineToolElliottImpulse:s.t(null,void 0,i(674118)),LineToolElliottTriangle:s.t(null,void 0,i(95840)),LineToolElliottTripleCombo:s.t(null,void 0,i(866637)),LineToolEllipse:s.t(null,void 0,i(469418)),LineToolExtended:s.t(null,void 0,i(302578)),LineToolFibChannel:s.t(null,void 0,i(482719)),LineToolFibCircles:s.t(null,void 0,i(464192)),LineToolFibRetracement:s.t(null,void 0,i(463835)),LineToolFibSpeedResistanceArcs:s.t(null,void 0,i(418072)),LineToolFibSpeedResistanceFan:s.t(null,void 0,i(220877)),LineToolFibSpiral:s.t(null,void 0,i(476783)),LineToolFibTimeZone:s.t(null,void 0,i(489037)),LineToolFibWedge:s.t(null,void 0,i(472489)),LineToolFlagMark:s.t(null,void 0,i(155678)),
LineToolImage:s.t(null,void 0,i(223450)),LineToolFlatBottom:s.t(null,void 0,i(829230)),LineToolAnchoredVWAP:s.t(null,void 0,i(961704)),LineToolGannComplex:s.t(null,void 0,i(366321)),LineToolGannFixed:s.t(null,void 0,i(887107)),LineToolGannFan:s.t(null,void 0,i(168102)),LineToolGannSquare:s.t(null,void 0,i(981180)),LineToolHeadAndShoulders:s.t(null,void 0,i(742616)),LineToolHorzLine:s.t(null,void 0,i(160049)),LineToolHorzRay:s.t(null,void 0,i(76604)),LineToolIcon:s.t(null,void 0,i(326579)),LineToolEmoji:s.t(null,void 0,i(285223)),LineToolInsidePitchfork:s.t(null,void 0,i(312354)),LineToolNote:s.t(null,void 0,i(275549)),LineToolNoteAbsolute:s.t(null,void 0,i(366828)),LineToolSignpost:s.t(null,void 0,i(368161)),LineToolParallelChannel:s.t(null,void 0,i(670394)),LineToolPitchfan:s.t(null,void 0,i(422293)),LineToolPitchfork:s.t(null,void 0,i(143852)),LineToolPolyline:s.t(null,void 0,i(953047)),LineToolPath:s.t(null,void 0,i(234402)),LineToolPrediction:s.t(null,void 0,i(436972)),LineToolPriceLabel:s.t(null,void 0,i(495921)),LineToolArrowMarker:s.t(null,void 0,i(982473)),LineToolPriceRange:s.t(null,void 0,i(102032)),LineToolProjection:s.t(null,void 0,i(187086)),LineToolRay:s.t(null,void 0,i(50470)),LineToolRectangle:s.t(null,void 0,i(200328)),LineToolCircle:s.t(null,void 0,i(490068)),LineToolRegressionTrend:s.t(null,void 0,i(435001)),LineToolRiskRewardLong:s.t(null,void 0,i(844604)),LineToolRiskRewardShort:s.t(null,void 0,i(937819)),LineToolFixedRangeVolumeProfile:s.t(null,{context:"study"},i(40434)),LineToolRotatedRectangle:s.t(null,void 0,i(409998)),LineToolSchiffPitchfork:s.t(null,void 0,i(518559)),LineToolSchiffPitchfork2:s.t(null,void 0,i(298114)),LineToolSineLine:s.t(null,void 0,i(369502)),LineToolText:s.t(null,{context:"tool"},i(20936)),LineToolTextAbsolute:s.t(null,void 0,i(694782)),LineToolThreeDrivers:s.t(null,void 0,i(298538)),LineToolTimeCycles:s.t(null,void 0,i(395005)),LineToolTrendAngle:s.t(null,void 0,i(294770)),LineToolTrendBasedFibExtension:s.t(null,void 0,i(715501)),LineToolTrendBasedFibTime:s.t(null,void 0,i(931196)),LineToolTrendLine:s.t(null,void 0,i(423104)),LineToolInfoLine:s.t(null,void 0,i(627677)),LineToolTriangle:s.t(null,void 0,i(729245)),LineToolTrianglePattern:s.t(null,void 0,i(112390)),LineToolVertLine:s.t(null,void 0,i(156211)),LineToolCrossLine:s.t(null,void 0,i(260997)),LineToolHighlighter:s.t(null,void 0,i(831895)),LineToolPriceNote:s.t(null,void 0,i(328625)),LineToolVbPFixed:s.t(null,void 0,i(518426))};(0,n.isFeatureEnabled)("remove-line-tool-ghost-feed")||(r.LineToolGhostFeed=s.t(null,void 0,i(807914))),r.LineToolTweet=s.t(null,void 0,i(100970)),r.LineToolIdea=s.t(null,void 0,i(241246))},404822:(e,t,i)=>{i.r(t),i.d(t,{sourceChangeEvent:()=>s,globalChangeEvent:()=>o,viewportChangeEvent:()=>a,selectionChangeEvent:()=>u});var n=i(827147);function s(e){return(0,n.default)(e)?{type:"data-source-change",sourceId:e}:{type:"data-source-change",...e}}const r={type:"global-change"};function o(){return r}const l={type:"viewport-change"};function a(){return l}const d={type:"selection-change"}
;function u(){return d}},854905:(e,t,i)=>{var n;i.d(t,{PaneCursorType:()=>n}),function(e){e[e.Default=0]="Default",e[e.Pointer=1]="Pointer",e[e.Eraser=2]="Eraser",e[e.Dot=3]="Dot",e[e.Grabbing=4]="Grabbing",e[e.ZoomIn=5]="ZoomIn",e[e.VerticalResize=6]="VerticalResize",e[e.HorizontalResize=7]="HorizontalResize",e[e.DiagonalNeSwResize=8]="DiagonalNeSwResize",e[e.DiagonalNwSeResize=9]="DiagonalNwSeResize"}(n||(n={}))},914679:(e,t,i)=>{i.r(t),i.d(t,{clearRectWithGradient:()=>o,fillRectInnerBorder:()=>l,drawHorizontalLine:()=>a,drawVerticalLine:()=>d,drawRoundRect:()=>c,drawRoundRectWithInnerBorder:()=>h,fillRectWithBorder:()=>p,createCircle:()=>v,drawPoly:()=>_,setLineStyle:()=>m,drawLine:()=>f});var n=i(86441),s=i(631586),r=i(96841);function o(e,t,i,n,s,r,o){e.save(),e.globalCompositeOperation="copy";const l=e.createLinearGradient(0,0,0,s);l.addColorStop(0,r),l.addColorStop(1,o),e.fillStyle=l,e.fillRect(t,i,n,s),e.restore()}function l(e,t,i,n,s,r){e.fillRect(t+r,i,n-2*r,r),e.fillRect(t+r,i+s-r,n-2*r,r),e.fillRect(t,i,r,s),e.fillRect(t+n-r,i,r,s)}function a(e,t,i,n){e.beginPath();const s=e.lineWidth%2?.5:0;e.moveTo(i,t+s),e.lineTo(n,t+s),e.stroke()}function d(e,t,i,n){e.beginPath();const s=e.lineWidth%2?.5:0;e.moveTo(t+s,i),e.lineTo(t+s,n),e.stroke()}function u(e,t){return Array.isArray(e)?e.map((e=>0===e?e:e+t)):e+t}function c(e,t,i,n,s,r,o){let l,a,d,u;if(Array.isArray(r))if(2===r.length){const e=Math.max(0,r[0]),t=Math.max(0,r[1]);l=e,a=e,d=t,u=t}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");l=Math.max(0,r[0]),a=Math.max(0,r[1]),d=Math.max(0,r[2]),u=Math.max(0,r[3])}else{const e=Math.max(0,r);l=e,a=e,d=e,u=e}o||e.beginPath(),e.moveTo(t+l,i),e.lineTo(t+n-a,i),0!==a&&e.arcTo(t+n,i,t+n,i+a,a),e.lineTo(t+n,i+s-d),0!==d&&e.arcTo(t+n,i+s,t+n-d,i+s,d),e.lineTo(t+u,i+s),0!==u&&e.arcTo(t,i+s,t,i+s-u,u),e.lineTo(t,i+l),0!==l&&e.arcTo(t,i,t+l,i,l)}function h(e,t,i,n,s,o,l=0,a=0,d="",h=r.LineStyle.Solid){if(e.save(),!a||!d||d===o)return c(e,t,i,n,s,l),e.fillStyle=o,e.fill(),void e.restore();const p=a/2;if("transparent"!==o){const p="transparent"!==d&&h!==r.LineStyle.Solid;c(e,p?t:t+a,p?i:i+a,p?n:n-2*a,p?s:s-2*a,p?l:u(l,-a)),e.fillStyle=o,e.fill()}if("transparent"!==d){c(e,t+p,i+p,n-a,s-a,u(l,-p)),e.lineWidth=a,e.strokeStyle=d,m(e,h),e.closePath(),e.stroke()}e.restore()}function p(e,t,i,s,r,o,l,a,d,u,c,h,p,v,_){const f=u?0:t,g=c?p:s;if(void 0!==o&&(e.fillStyle=o,e.fillRect(f,i,g-f+v,r-i)),void 0!==l&&a>0){if(e.beginPath(),m(e,d),void 0!==_){const t=_.map((e=>e*a));e.setLineDash(t)}let o=(0,n.point)(0,0),u=(0,n.point)(0,0),c=(0,n.point)(0,0),p=(0,n.point)(0,0);switch(h){case"outer":{const e=.5*a;c=(0,n.point)(0,e),p=(0,n.point)(0,e),o=(0,n.point)(e,-a),u=(0,n.point)(e,-a);break}case"center":{const e=a%2?.5:0,t=a%2?.5:v;c=(0,n.point)(.5*a-e,-e),p=(0,n.point)(t+.5*a,-e),o=(0,n.point)(-e,e+.5*a),u=(0,n.point)(t,e+.5*a);break}case"inner":{const e=.5*a;c=(0,n.point)(0,-e),p=(0,n.point)(1,-e),o=(0,n.point)(-e,a),u=(0,n.point)(1-e,a);break}}e.lineWidth=a,e.strokeStyle=l,
e.moveTo(f-c.x,i-c.y),e.lineTo(g+p.x,i-p.y),e.moveTo(s+u.x,i+u.y),e.lineTo(s+u.x,r-u.y),e.moveTo(f-c.x,r+c.y),e.lineTo(g+p.x,r+p.y),e.moveTo(t-o.x,i+o.y),e.lineTo(t-o.x,r-o.y),e.stroke()}}function v(e,t,i,n){e.beginPath(),e.arc(t,i,n,0,2*Math.PI,!1),e.closePath()}function _(e,t,i){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(const i of t)e.lineTo(i.x,i.y);e.closePath(),e.stroke(),i&&e.fill()}function m(e,t){let i=[];t!==s.LINESTYLE_SOLID&&(i=function(e,t){return[[e.lineWidth,2*e.lineWidth],[5*e.lineWidth,6*e.lineWidth],[6*e.lineWidth,6*e.lineWidth],[e.lineWidth,4*e.lineWidth],[2*e.lineWidth,e.lineWidth]][t-1]}(e,t)),e.setLineDash(i)}function f(e,t,i,n,s){isFinite(t)&&isFinite(n)&&isFinite(i)&&isFinite(s)&&(e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(n,s),e.stroke(),e.restore())}},841404:(e,t,i)=>{i.d(t,{PriceAxisView:()=>p});var n=i(86441),s=i(934026),r=i(545613),o=i(768038),l=i(741341),a=i(858063),d=i(914679),u=i(854905);class c{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,n,s,r,a){var u,c,h;const p=this._data;if(!p.visible||this._isOutOfScreen(t,s))return;const v=this._commonData,_=void 0!==p.labelIcon,m=p.ignoreOffset?0:t.offsetSize,f=t.borderSize,g=t.paddingTop+v.additionalPaddingTop,b=t.paddingBottom+v.additionalPaddingBottom,y=t.paddingInner,S=t.paddingOuter,P=t.fontSize;let x=p.text,T=p.textColor||v.textColor,w=p.secondLine||"",C=v.secondLineTextColor||T,A=p.thirdLine||"";const I=v.thirdLineTextColor||T;0===w.length&&(w=A,C=I,A=""),0===x.length&&(x=w,T=C,w=A,C=I,A=""),e.save(),e.font=t.font;const M=i.yMidCorrection(e,x)*a,L=Math.ceil(i.measureText(e,x)),R=P+g+b,D=Boolean(w),V=Boolean(A),k=D?Math.ceil(i.measureText(e,w)):0,E=V?Math.ceil(i.measureText(e,A)):0,N=f+y+S+L+m,F=k>0?f+y+S+k+m:0,z=E>0?f+y+S+E+m:0,O=Math.max(N,F,z),H=Math.max(1,Math.floor(a));let B=Math.round(R*a);B%2!=H%2&&(B+=1);const W=Math.round((P+t.lineSpacing)*a),U=Math.round(2*(P+t.lineSpacing)*a),K=Math.max(1,Math.floor(f*a)),j=p.separatorVisible?K:0,G=p.borderVisible?K:0,$=_?B:Math.round(O*a),Z=Math.round(m*a),q=Math.ceil(n*a),Y=Math.ceil(y*a),J=Math.round((null!==(u=v.fixedCoordinate)&&void 0!==u?u:v.coordinate)*a)-Math.floor(.5*a),Q=Math.floor(J+H/2-B/2),X=Q+B,ee="right"===r,te=ee?q-j:j,ie=q;let ne,se=te;const re=null!==(c=p.backgroung)&&void 0!==c?c:v.background;e.fillStyle=re;const oe=2*a;if(e.textAlign=ee?"right":"left",e.textBaseline="middle",ee?(se=te-$,ne=te-Z-Y-1):(se=te+$,ne=te+Z+Y),x||_){const i=V?B+U:D?B+W:B;if(((t,n,s)=>{ee?(0,d.drawRoundRectWithInnerBorder)(e,se,Q,$,i,t,[oe,0,0,oe],G,n,s):(0,d.drawRoundRectWithInnerBorder)(e,te,Q,$,i,t,[0,oe,oe,0],G,n,s)})(re,null!==(h=v.borderColor)&&void 0!==h?h:re,v.borderStyle),p.separatorVisible&&(e.fillStyle=t.paneBackgroundColor,e.fillRect(ee?ie-j:0,Q,j,X-Q)),_){switch(p.labelIcon){case 0:this._drawPlusIcon(e,te,se,Q,J,X,H);break;case 1:this._drawClockIcon(e,te,se,J,H,a)}return void e.restore()}e.save(),e.translate(ne,(Q+X)/2+M),(0,l.drawScaled)(e,a,(()=>{e.fillStyle=T,e.fillText(x,0,0)})),e.restore()}D&&(e.fillStyle=C,e.save(),
e.translate(ne,(Q+X)/2+M+W),(0,l.drawScaled)(e,a,(()=>{e.fillText((0,o.startWithLTR)(w),0,0)})),e.restore()),V&&(e.fillStyle=I,e.save(),e.translate(ne,(Q+X)/2+M+U),(0,l.drawScaled)(e,a,(()=>{e.fillText((0,o.startWithLTR)(A),0,0)})),e.restore()),e.restore()}topBottomTotalHeight(e){const t=this._lines();if(!this._data.visible||0===t)return{top:0,bottom:0,total:0};const i=e.fontSize/2+e.paddingTop+this._commonData.additionalPaddingTop,n=(t-.5)*e.fontSize+(t-1)*e.lineSpacing+e.paddingBottom+this._commonData.additionalPaddingBottom;return{top:i,bottom:n,total:i+n}}hitTest(e){const t=this._data.hitTestData;if(void 0===t||!this._data.visible)return null;const i=(0,r.lastMouseOrTouchEventInfo)().isTouch?10:0,o=(0,n.box)(new n.Point(t.xl-i,t.y-i),new n.Point(t.xl+t.containerWidth+i,t.y+t.containerHeight+i)),l=t.left&&(0,s.pointInBox)(e,o),d=(0,n.box)(new n.Point(t.xr-i,t.y-i),new n.Point(t.xr+t.containerWidth+i,t.y+t.containerHeight+i)),c=t.right&&(0,s.pointInBox)(e,d);if(l||c){const i=l?"left":"right";return new a.HitTestResult(a.HitTestResult.CUSTOM,{cursorType:u.PaneCursorType.Default,clickHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tapHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tooltip:t.tooltip})}return null}_drawPlusIcon(e,t,i,n,s,r,o){e.fillStyle=this._commonData.textColor,e.strokeStyle=this._commonData.textColor,e.lineWidth=o;const l=Math.abs(t-i);let a=Math.round(.35*l);a%2!=o%2&&(a+=1);let d=Math.round(.65*l);d%2!=o%2&&(d+=1);const u=Math.floor((l-a)/2),c=Math.min(t,i),h=c+Math.floor(l/2-o/2);e.fillRect(c+u,s,a,o),e.fillRect(h,n+u,o,a),e.beginPath(),e.arc(h+o/2,s+o/2,d/2,0,2*Math.PI,!1),e.stroke()}_drawClockIcon(e,t,i,n,s,r){e.fillStyle=this._commonData.textColor,e.lineWidth=s;const o=Math.abs(t-i);let l=Math.round(.35*o);l%2!=s%2&&(l+=1);let a=Math.round(.65*o);a%2!=s%2&&(a+=1);const d=Math.min(t,i)+Math.floor(o/2-s/2);e.save(),e.translate(d+s/2-a/2,n+s/2-a/2),e.scale(r,r);const u=new Path2D("M7.5 0.8a1 1 0 0 0 0 13.4 1 1 0 0 0 0-13.4zm0 1a1 1 0 0 1 0 11 1 1 0 0 1 0-11zm-.97-.25A3.5 3.5 0 0 0 3.5 0 3.5 3.5 0 0 0 0 3.5a3.5 3.5 0 0 0 1.75 3.03l.5-.86A2.5 2.5 0 0 1 1 3.5 2.5 2.5 0 0 1 3.5 1a2.5 2.5 0 0 1 2.17 1.25zm6.72 4.78A3.5 3.5 0 0 0 15 3.5 3.5 3.5 0 0 0 11.5 0a3.5 3.5 0 0 0-3.03 1.75l.86.5A2.5 2.5 0 0 1 11.5 1 2.5 2.5 0 0 1 14 3.5a2.5 2.5 0 0 1-1.25 2.17zM7 5h1v5H7zm3 2v1H5V7z");e.fill(u),e.restore()}_lines(){const e=this._data;return(e.text?1:0)+(e.secondLine?1:0)+(e.thirdLine?1:0)}_isOutOfScreen(e,t){var i;const n=this._commonData,s=null!==(i=n.fixedCoordinate)&&void 0!==i?i:n.coordinate,{total:r}=this.topBottomTotalHeight(e),o=r/this._lines();return s-o/2-3>t||s+(r-o/2)+3<0}}var h=i(114123);class p{constructor(e){this._commonRendererData={coordinate:0,textColor:"#FFF",background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this._axisRendererData={text:"",visible:!1,separatorVisible:!1,borderVisible:!1,ignoreOffset:!1},this._paneRendererData={text:"",visible:!1,separatorVisible:!0,borderVisible:!1,ignoreOffset:!0},this._invalidated=!0,
this._axisRenderer=new(e||c)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(e||c)(this._paneRendererData,this._commonRendererData)}text(){return this._updateRendererDataIfNeeded(),this._axisRendererData.text}secondLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.secondLine}thirdLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.thirdLine}background(){return this._updateRendererDataIfNeeded(),this._commonRendererData.background}color(){return this._updateRendererDataIfNeeded(),this.generateTextColor(this.background())}generateTextColor(e){return(0,h.colorFromBackground)(e)}coordinate(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate}floatCoordinate(){var e;return this._updateRendererDataIfNeeded(),null!==(e=this._commonRendererData.floatCoordinate)&&void 0!==e?e:this._commonRendererData.coordinate}update(e){this._invalidated=!0}topBottomTotalHeight(e){this._updateRendererDataIfNeeded();const{top:t,bottom:i,total:n}=this._axisRenderer.topBottomTotalHeight(e),{top:s,bottom:r,total:o}=this._paneRenderer.topBottomTotalHeight(e);return{top:Math.max(t,s),bottom:Math.max(i,r),total:Math.max(n,o)}}getFixedCoordinate(){return this._commonRendererData.fixedCoordinate||0}setFixedCoordinate(e){this._commonRendererData.fixedCoordinate=e}isVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible}isAxisLabelVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible}isPaneLabelVisible(){return this._updateRendererDataIfNeeded(),this._paneRendererData.visible}renderer(){return this._updateRendererDataIfNeeded(),this._axisRenderer}paneRenderer(){return this._updateRendererDataIfNeeded(),this._paneRenderer}setPaneRendererLabelIcon(e){this._paneRendererData.labelIcon=e}setPaneLabelVisible(e){this._paneRendererData.visible=e,this._invalidated=!0}ignoreAlignment(){return!1}_updateRendererDataIfNeeded(){this._invalidated&&(this._commonRendererData.fixedCoordinate=void 0,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData),this._invalidated=!1)}}},506845:(e,t,i)=>{i.d(t,{createPrimitiveProperty:()=>r});var n=i(40210),s=i.n(n);function r(e){return new(s())(e)}},40210:(e,t,i)=>{var n=i(869403),s=i(758337).isFunction;function r(e){if(this._listeners=new n,this._childs=[],this._muteChildChanges=!1,void 0!==e)if(this.isPrimitiveType(e))this._value=e;else for(var t in e)this.addProperty(t,e[t])}r.prototype.merge=function(e,t){var i=null;if(t)var n=(i=[]).length;if(void 0===e)return i;if(this.isPrimitiveType(e))return t&&this._value!==e&&i.push(this),this._value=e,i;if(Array.isArray(e))for(var s=0;s<e.length;s++)if(this[s]){var r=this[s].merge(e[s],t);t&&(i=i.concat(r))}else this.addProperty(s,e[s]),t&&i.push(this[s]);else for(var o in e)if(this[o]){r=this[o].merge(e[o],t);t&&void 0!==r&&(i=i.concat(r))}else this.addProperty(o,e[o]),t&&i.push(this[o]);return t&&i.length>n&&i.push(this),i},
r.prototype.mergeAndFire=function(e){var t=this.merge(e,!0);this._muteChildChanges=!0,t.forEach((function(e){e._muteChildChanges=!0})),t.forEach((function(e){e._muteChildChanges=!1,e.listeners().fire(e)})),this._muteChildChanges=!1,t.length>0&&this.listeners().fire(this)},r.prototype.state=function(e){var t=s(this.value)?this.value():void 0;void 0===t&&(t={});for(var i=0;i<this._childs.length;i++){var n=this._childs[i];if(e&&-1!==e.indexOf(n))continue;const s=this[n];let a;if(e){for(var r=[],o=0;o<e.length;o++){var l=e[o];l.startsWith(n+".")&&r.push(l.substring(n.length+1))}a=s.state(r)}else a=s.state();(void 0!==a||s.storeStateIfUndefined())&&(t[n]=a)}return t},r.prototype.storeStateIfUndefined=function(){return!0},r.prototype.clone=function(e){return new r(this.state())},r.prototype.isPrimitiveType=function(e){return null===e||(!!isNumber(e)||("string"==typeof e||"boolean"==typeof e))},r.prototype.value=function(){return this._value},r.prototype.listeners=function(){return this._listeners},r.prototype.childCount=function(){return this._childs.length},r.prototype.childNames=function(){return this._childs},r.prototype.child=function(e){return this[e]},r.prototype.setValue=function(e,t){(this._value!==e||t)&&(this._value=e,this._listeners.fire(this))},r.prototype.setValueSilently=function(e){this._value=e},r.prototype.addProperty=function(e,t){var i=new r(t);this[e]=i,this._childs.push(e),i.subscribe(this,this.childChanged)},r.prototype.removeProperty=function(e){this[e].unsubscribe(this,this.childChanged),delete this[e],this._childs=this._childs.filter((function(t){return t!==e}))},r.prototype.hasChild=function(e){return this._childs.indexOf(e)>=0},r.prototype.addChild=function(e,t){this[e]&&this[e].unsubscribe(this,this.childChanged),this[e]=t,-1===this._childs.indexOf(e)&&this._childs.push(e),t.subscribe(this,this.childChanged)},r.prototype.childChanged=function(e,t){this._muteChildChanges||this.listeners().fire(this)},r.prototype.subscribe=function(e,t){this.listeners().subscribe(e,t,!1)},r.prototype.unsubscribe=function(e,t){this.listeners().unsubscribe(e,t)},r.prototype.unsubscribeAll=function(e){this.listeners().unsubscribeAll(e)},r.prototype.childs=function(){return this},e.exports=r},991826:(e,t,i)=>{i.d(t,{normalizeIntervalString:()=>p,isAvailable:()=>v,setLastUsedResolution:()=>_,getDefaultResolution:()=>m,getResolutionByChartStyle:()=>f,getApplicableIntervalForFrequency:()=>g,getServerInterval:()=>b,isResolutionMultiplierValid:()=>y,getMaxResolutionValue:()=>P,convertResolutionsFromSettings:()=>x,mergeResolutions:()=>T,sortResolutions:()=>w,compareResolutions:()=>A,getTranslatedResolution:()=>I,getTranslatedResolutionModel:()=>M,isSecondsEnabled:()=>R});var n=i(777754),s=i(568450),r=i(720444),o=i(62802),l=i(583912),a=i(588565),d=i(758337);i(495046);const u={[s.ResolutionKind.Ticks]:1,[s.ResolutionKind.Seconds]:60,[s.ResolutionKind.Minutes]:1440,[s.SpecialResolutionKind.Hours]:24,[s.ResolutionKind.Days]:365,[s.ResolutionKind.Weeks]:52,[s.ResolutionKind.Months]:12,[s.ResolutionKind.Range]:1e6,
[s.ResolutionKind.Invalid]:NaN},c={[s.ResolutionKind.Ticks]:0,[s.ResolutionKind.Seconds]:1,[s.ResolutionKind.Minutes]:2,[s.SpecialResolutionKind.Hours]:3,[s.ResolutionKind.Days]:4,[s.ResolutionKind.Weeks]:5,[s.ResolutionKind.Months]:6,[s.ResolutionKind.Range]:7,[s.ResolutionKind.Invalid]:8},h={[s.ResolutionKind.Invalid]:"",[s.ResolutionKind.Ticks]:n.t(null,{context:"interval_short"},i(959231)),[s.ResolutionKind.Seconds]:n.t(null,{context:"interval_short"},i(2949)),[s.ResolutionKind.Minutes]:n.t(null,{context:"interval_short"},i(806791)),[s.SpecialResolutionKind.Hours]:n.t(null,{context:"interval_short"},i(113994)),[s.ResolutionKind.Days]:n.t(null,{context:"interval_short"},i(713395)),[s.ResolutionKind.Weeks]:n.t(null,{context:"interval_short"},i(185521)),[s.ResolutionKind.Months]:n.t(null,{context:"interval_short"},i(137720)),[s.ResolutionKind.Range]:n.t(null,{context:"interval_short"},i(269838))};function p(e){return s.Interval.parse(e).value()}function v(e){const t=s.Interval.parse(e);if(t.isRange())return l.linking.range.value();const i=t.value(),n=l.linking.dataFrequencyResolution.value();if(void 0!==n&&A(i,n)<0)return!1;const r=l.linking.supportedResolutions.value();return void 0!==r?void 0!==r.find((e=>p(e)===i)):t.isIntraday()?Boolean(l.linking.intraday.value()):t.isDWM()}function _(e){s.Interval.isValid(e)&&(s.Interval.isRange(e)?o.setValue("chart.lastUsedRangeResolution",e):o.setValue("chart.lastUsedTimeBasedResolution",e))}function m(e){return e?"100R":"1D"}function f(e,t,i){const n=r.isRangeStyle(e),l=s.Interval.isRange(t);return!n&&l?function(e){const t=o.getValue("chart.lastUsedTimeBasedResolution");if(void 0!==t&&s.Interval.isTimeBased(t))return t;let i="1D";for(const t of e){const e=s.Interval.parse(t);if(e.isTimeBased()){const t=e.value();if("1D"===t)return t;i=t}}return i}(i):n&&!l?function(e){const t=o.getValue("chart.lastUsedRangeResolution");if(void 0!==t&&s.Interval.isRange(t))return t;let i="100R";for(const t of e){const e=s.Interval.parse(t);if(e.isRange()){const t=e.value();if("100R"===t)return t;i=t}}return i}(i):t}function g(e,t){return A(t,e)>=0?t:e}function b(e){return s.Interval.isRange(e)?"1":e}function y(e){const{interval:t,guiResolutionKind:i}=s.Interval.parseExt(e);if(!t.isValid())return!1;return(i===s.SpecialResolutionKind.Hours?t.multiplier()/60:t.multiplier())<=S(i)}function S(e){const t=u[e];return Number.isNaN(t)?1:t}function P(e){return S(s.Interval.parseExt(e).guiResolutionKind)}function x(e){return Array.isArray(e)?e:Object.keys(e).map(s.Interval.normalize).filter(d.notNull)}function T(...e){let t=[].concat(...e);return t=(0,a.uniq)(t.filter(y).map(p)),w(t)}function w(e){return e.sort(A)}function C(e){const t=s.Interval.parse(e),i=t.multiplier()||1;return t.isMinuteHours()?[s.SpecialResolutionKind.Hours,i/60]:[t.kind(),i]}function A(e,t){if(e===t)return 0;const[i,n]=C(e),[s,r]=C(t);return i!==s?c[i]-c[s]:n-r}function I(e){const{multiplier:t,shortKind:i}=M(e);return`${t}${i}`}function M(e,t){const i=s.Interval.parse(e);let n=i.multiplier(),r=i.kind();if(!i.isValid()){
if(t)return null;throw new TypeError("Can't translate invalid interval")}return i.isMinuteHours()&&(n=Math.floor(n/60),r=s.SpecialResolutionKind.Hours),{multiplier:n.toString(),shortKind:L(r),hint:`${n} ${L(r,n)}`,mayOmitMultiplier:i.isDWM()&&1===n,mayOmitShortKind:i.isMinutes()&&!i.isMinuteHours()}}function L(e,t){if(!t)return h[e];switch(e){case s.ResolutionKind.Ticks:return n.t(null,{plural:"ticks",count:t},i(699136));case s.ResolutionKind.Days:return n.t(null,{plural:"days",count:t},i(730572));case s.ResolutionKind.Weeks:return n.t(null,{plural:"weeks",count:t},i(947966));case s.ResolutionKind.Months:return n.t(null,{plural:"months",count:t},i(99062));case s.ResolutionKind.Seconds:return n.t(null,{plural:"seconds",count:t},i(671787));case s.ResolutionKind.Minutes:return n.t(null,{plural:"minutes",count:t},i(569143));case s.SpecialResolutionKind.Hours:return n.t(null,{plural:"hours",count:t},i(52254));case s.ResolutionKind.Range:return n.t(null,{plural:"ranges",count:t},i(682797));default:return e}}function R(){return!0}},796309:(e,t,i)=>{i.d(t,{seriesPrice:()=>r,positionVisualDirection:()=>l,positionToCoordinate:()=>a,noDataBasePosition:()=>d,seriesBasePosition:()=>u,getNoDataPosition:()=>c,getSeriesPosition:()=>h});var n=i(650151),s=i(812363);function r(e,t,i){const n=e.barFunction();switch(e.style()){case 3:case 10:case 2:return n(t.value);default:return t.value[-1===i?3:2]}}function o(e){return e>=0?1:-1}function l(e,t){return-1===o(e)!==t?-1:1}function a(e,t,i,n){const s=Math.min(t,Math.max(0,1===n?i:t-i));return i-n*Math.abs(s*e/100)}function d(e,t,i){const n=e.index();return null===n?null:{index:n,price:t.coordinateToPrice(t.height()/2,i)}}function u(e,t){const i=e.data().bars(),n=i.first(),l=i.last();if(null===n||null===l)return null;let a;const d=t.index();if(null===d){if(void 0===t.time)return null;const e=t.time(),r=n.value[0],o=l.value[0];if(e<r-86400||e>o)return null;a=i.searchByTime(e,s.PlotRowSearchMode.NearestRight,4)}else a=i.search(d);return null===a?null:{index:a.index,price:r(e,a,o(t.position()))}}function c(e,t,i){const n=d(e,t,i);if(null===n)return null;const s=l(e.position(),t.isInverted());return{index:n.index,price:n.price,poleStartY:t.height(),visualDirection:1,positionPointDirection:s,startsOnSeriesData:!1}}function h(e,t,i=!0){const s=u(e,t),r=e.priceScale(),o=(0,n.ensureNotNull)(e.firstValue());if(null===s)return c(t,r,o);let a=0;const d=e.properties().childs(),h=e.model().timeScale(),p=r.priceToCoordinate(s.price,o);if(i)switch(e.style()){case 3:a=d.areaStyle.childs().linewidth.value()/2;break;case 2:a=d.lineStyle.childs().linewidth.value()/2;break;case 10:const e=Math.abs(100-d.baselineStyle.childs().baseLevelPercentage.value());a=r.height()*e/100>p?d.baselineStyle.childs().topLineWidth.value()/2:d.baselineStyle.childs().bottomLineWidth.value()/2;break;case 1:case 9:case 8:case 12:case 4:case 7:a=3;break;case 0:a=d.barStyle.childs().thinBars.value()?3:Math.max(3,.25*h.barSpacing());break;case 11:a=d.rangeStyle.childs().thinBars.value()?3:Math.max(3,.25*h.barSpacing());break;case 5:
a=Math.max(4,.25*h.barSpacing());break;case 6:a=Math.max(5,.25*h.barSpacing())}const v=l(t.position(),r.isInverted()),_=p-v*a;return{index:s.index,price:s.price,poleStartY:_,visualDirection:v,positionPointDirection:v,startsOnSeriesData:!0}}},96841:(e,t,i)=>{var n,s,r,o;i.d(t,{MarkLocation:()=>n,HAlign:()=>s,LineStyle:()=>o}),function(e){e.AboveBar="AboveBar",e.BelowBar="BelowBar",e.Top="Top",e.Bottom="Bottom",e.Right="Right",e.Left="Left",e.Absolute="Absolute",e.AbsoluteUp="AbsoluteUp",e.AbsoluteDown="AbsoluteDown"}(n||(n={})),function(e){e.Left="left",e.Center="center",e.Right="right"}(s||(s={})),function(e){e.Top="top",e.Middle="middle",e.Bottom="bottom"}(r||(r={})),function(e){e[e.Solid=0]="Solid",e[e.Dotted=1]="Dotted",e[e.Dashed=2]="Dashed"}(o||(o={}))},992001:(e,t,i)=>{i.d(t,{areEqualSymbols:()=>o,symbolSameAsCurrent:()=>a,unitsAreSame:()=>d,currenciesAreSame:()=>u});var n=i(495046),s=i(720444);const r=n.enabled("uppercase_instrument_names");function o(e,t){return void 0===e?void 0===t:void 0!==t&&(r?e.toUpperCase()===t.toUpperCase():e===t)}function l(e,t){return e.some((e=>o(t,e)))}function a(e,t){if(null===t)return!1;if(t){if(o(t.full_name,e)||o(t.pro_name,e))return!0;if(o(t.ticker,e))return!0;if(t.aliases&&l(t.aliases,e))return!0;if(t.alternatives&&l(t.alternatives,e))return!0;if(0===e.indexOf("FRA:")&&o(t.pro_name,e.replace("FRA:","FWB:")))return!0}return!1}function d(e,t,i){return null===e&&!(0,s.isConvertedToOtherUnit)(t,i)||e===(0,s.symbolUnit)(t,i)}function u(e,t){return null===e&&!(0,s.isConvertedToOtherCurrency)(t)||e===(0,s.symbolCurrency)(t)}},81947:(e,t,i)=>{i.d(t,{TimeAxisView:()=>o});var n=i(114123),s=i(741341);class r{constructor(){this._data=null}setData(e){this._data=e}draw(e,t,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const n=this._data;e.font=t.font;const r=Math.round(t.widthCache.measureText(e,n.text));if(r<=0)return;e.save();const o=t.paddingHorizontal,l=r+2*o,a=l/2;let d=n.coordinate,u=Math.floor(d-a)+.5;if(n.alwaysInViewPort){const e=n.width;u<0?(d+=Math.abs(0-u),u=Math.floor(d-a)+.5):u+l>e&&(d-=Math.abs(e-(u+l)),u=Math.floor(d-a)+.5)}const c=u+l,h=Math.ceil(0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize+t.paddingBottom);e.fillStyle=n.background;const p=Math.round(u*i),v=Math.round(0*i),_=Math.round(c*i),m=Math.round(h*i),f=Math.round(2*i);e.beginPath(),e.moveTo(p,v),e.lineTo(p,m-f),e.arcTo(p,m,p+f,m,f),e.lineTo(_-f,m),e.arcTo(_,m,_,m-f,f),e.lineTo(_,v),e.fill();const g=0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize/2;e.textAlign="left",e.textBaseline="middle",e.fillStyle=n.color;const b=t.widthCache.yMidCorrection(e,"Apr0");e.translate((u+o)*i,(g+b)*i),(0,s.drawScaled)(e,i,(()=>e.fillText(n.text,0,0))),e.restore()}}class o{constructor(e){this._renderer=new r,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=e,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),
this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_getText(e){const t=this._model.timeScale().indexToUserTime(e);return null!==t?this._model.dateTimeFormatter().format(t):""}_updateImpl(){const e=this._rendererData;if(e.visible=!1,this._model.timeScale().isEmpty()||!this._isVisible())return;const t=this._getIndex();null!==t&&(e.visible=!0,e.width=this._model.timeScale().width(),e.background=this._getBgColor(),e.color=(0,n.colorFromBackground)(e.background),e.coordinate=this._model.timeScale().indexToCoordinate(t),e.alwaysInViewPort=this._getAlwaysInViewPort(),e.text=this._getText(t),this._invalidated=!1)}}},930981:(e,t,i)=>{i.d(t,{getChartAlertsFacade:()=>r,getChartAlertsFacadeIfCreatedBefore:()=>o});var n=i(240158);let s;async function r(){return void 0===s&&(s=await async function(){const[e,t]=await Promise.all([Promise.all([i.e(69940),i.e(58194),i.e(27373),i.e(25977),i.e(68647),i.e(58272),i.e(21350),i.e(55303),i.e(61929),i.e(48158)]).then(i.bind(i,246337)),(0,n.getPriceAlertsDispatcher)()]);return new e.ChartAlertsFacadeOld(t)}()),s}function o(){return null!=s?s:null}},114123:(e,t,i)=>{i.r(t),i.d(t,{generateColor:()=>s,applyAlpha:()=>r,alphaToTransparency:()=>o,transparencyToAlpha:()=>l,applyTransparency:()=>a,resetTransparency:()=>d,getLuminance:()=>u,isHexColor:()=>c,colorFromBackground:()=>h,gradientColorAtPercent:()=>p,isColorDark:()=>v,rgbaFromInteger:()=>_,rgbaToInteger:()=>m,colorToInteger:()=>f});var n=i(724377);function s(e,t,i){if(t=t||0,!c(e))return i?(0,n.rgbaToString)((0,n.rgba)((0,n.parseRgb)(e),(0,n.normalizeAlphaComponent)(l(t)))):e;const[s,r,o]=(0,n.parseRgb)(e),a=(0,n.normalizeAlphaComponent)(l(t));return(0,n.rgbaToString)([s,r,o,a])}function r(e,t){return s(e,o(t))}function o(e){return 100*(1-e)}function l(e){if(e<0||e>100)throw new Error("invalid transparency");return 1-e/100}function a(e,t){if("transparent"===e)return e;const i=(0,n.parseRgba)(e),s=i[3];return(0,n.rgbaToString)((0,n.rgba)(i[0],i[1],i[2],l(t)*s))}function d(e){return"transparent"===e||c(e)?e:(0,n.rgbaToString)((0,n.rgba)((0,n.parseRgb)(e),(0,n.normalizeAlphaComponent)(1)))}function u(e){const t=(0,n.parseRgb)(e).map((e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function c(e){return 0===e.indexOf("#")}function h(e){return"black"===(0,n.rgbToBlackWhiteString)((0,n.parseRgb)(e),150)?"#ffffff":"#000000"}function p(e,t,i){const[s,r,o,l]=(0,n.parseRgba)(e),[a,d,u,c]=(0,n.parseRgba)(t),h=(0,n.rgba)(Math.round(s+i*(a-s)),Math.round(r+i*(d-r)),Math.round(o+i*(u-o)),l+i*(c-l));return(0,n.rgbaToString)(h)}function v(e){return u(d(e))<.5}function _(e){const t=(e=Math.round(e))%256;e-=t;const i=(e/=256)%256;e-=i;const n=(e/=256)%256;e-=n;return`rgba(${t},${i},${n},${(e/=256)/255})`}function m(e){const t=Math.round(255*e[3]);return e[0]+256*e[1]+65536*e[2]+16777216*t}function f(e){const t=(0,n.tryParseRgba)(e);return null===t?0:m(t)}},844106:(e,t,i)=>{i.d(t,{showGoProAlertsOnSecondsDialog:()=>s})
;var n=i(508846);function s(){(0,n.createGoProDialog)({feature:"alertsOnSeconds"})}},835343:(e,t,i)=>{function n(e){let t;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if(e instanceof Date)t=new Date(e.valueOf());else if(Array.isArray(e)){t=[];let i=0;const s=e.length;for(;i<s;i++)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n(e[i]))}else{t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n(e[i]))}return t}i.d(t,{deepCopy:()=>n})}}]);